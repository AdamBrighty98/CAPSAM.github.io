---
title: "Homepage"
runtime: shiny
---

## Climate and Air Pollution Synergies Assessment Model (CAPSAM)

Welcome to CAPSAM. A quick and simple model designed to assess how future decarbonisation scenarios will impact air quality.

Fill in the boxes below to more accurately specific your scenario to improve CAPSAM's output and input your scenario data.

```{r, echo=FALSE}


# Loading in data - all impact factors, emission factors, and assumption CSV files
elec_gen_EFs <- read.csv("C:/Users/ab22/Desktop/CAPSAM_CSVs/Elec_EFs_kt_TWh.csv")
dom_heat_EFs <- read.csv("C:/Users/ab22/Desktop/CAPSAM_CSVs/Res_Heat_EFs_kt_TWh.csv")
pub_heat_EFs <- read.csv("C:/Users/ab22/Desktop/CAPSAM_CSVs/Pub_Heat_EFs_kt_TWh.csv")
ind_com_EFs <- read.csv("C:/Users/ab22/Desktop/CAPSAM_CSVs/Ind_Com_EFs_kt_TWh.csv")
hyd_prod_EFs <- read.csv("C:/Users/ab22/Desktop/CAPSAM_CSVs/Hydrogen_Production_EFs_kt_TWh.csv")
impact_factors <- read.csv("C:/Users/ab22/Desktop/CAPSAM_CSVs/UK_to_UK_IFs.csv")



# Simplifying names of emission factors - setting them to recognisable names

# Electricity Emission and Impact Factors
# CO2 emission factors
elec_co2_EF_Biomass <- elec_gen_EFs[6,3]
elec_co2_EF_BECCS <- elec_gen_EFs[11,3]
elec_co2_EF_Gas <- elec_gen_EFs[2,3]
elec_co2_EF_GasCCS <- elec_gen_EFs[9,3]
elec_co2_EF_Hydrogen <- elec_gen_EFs[4,3]
elec_co2_EF_Coal <- elec_gen_EFs[1,3]
elec_co2_EF_Waste <- elec_gen_EFs[8,3]
elec_co2_EF_OtherThermal <- elec_gen_EFs[5,3]

# NOx emission factors
elec_nox_EF_Biomass <- elec_gen_EFs[6,4]
elec_nox_EF_BECCS <- elec_gen_EFs[11,4]
elec_nox_EF_Gas <- elec_gen_EFs[2,4]
elec_nox_EF_GasCCS <- elec_gen_EFs[9,4]
elec_nox_EF_Hydrogen <- elec_gen_EFs[4,4]
elec_nox_EF_Coal <- elec_gen_EFs[1,4]
elec_nox_EF_Waste <- elec_gen_EFs[8,4]
elec_nox_EF_OtherThermal <- elec_gen_EFs[5,4]

#PM2.5 emission factors
elec_pm25_EF_Biomass <- elec_gen_EFs[6,5]
elec_pm25_EF_BECCS <- elec_gen_EFs[11,5]
elec_pm25_EF_Gas <- elec_gen_EFs[2,5]
elec_pm25_EF_GasCCS <- elec_gen_EFs[9,5]
elec_pm25_EF_Hydrogen <- elec_gen_EFs[4,5]
elec_pm25_EF_Coal <- elec_gen_EFs[1,5]
elec_pm25_EF_Waste <- elec_gen_EFs[8,5]
elec_pm25_EF_OtherThermal <- elec_gen_EFs[5,5]

#pNOx Electricity Impact Factors
elec_nox_IF_Gas <- impact_factors[1,7]
elec_nox_IF_Landfill <- impact_factors[2,7]
elec_nox_IF_Other <- impact_factors[3,7]

#PM2.5 Electricity Impact Factors
elec_pm25_IF_Gas <- impact_factors[1,6]
elec_pm25_IF_Landfill <- impact_factors[2,6]
elec_pm25_IF_Other <- impact_factors[3,6]

###################################################################################################

# Building Heating Emission and Impact Factors
# Domestic Heat CO2 Emission Factors
dh_co2_EF_SSF_stove <- dom_heat_EFs[1,2]
dh_co2_EF_SSF_boiler <- dom_heat_EFs[2,2]
dh_co2_EF_gasoil_boiler <- dom_heat_EFs[3,2]
dh_co2_EF_gas_boiler <- dom_heat_EFs[4,2]
dh_co2_EF_woodpellet_boiler <- dom_heat_EFs[5,2]
dh_co2_EF_wood_boiler <- dom_heat_EFs[6,2]
dh_co2_EF_wood_fireplace <- dom_heat_EFs[7,2]
dh_co2_EF_hydrogen_boiler <- dom_heat_EFs[8,2]
dh_co2_EF_hydrogen_natgas_boiler <- dom_heat_EFs[9,2]
dh_co2_EF_coal_stove <- dom_heat_EFs[10,2]

# Domestic Heat NOx Emission Factors
dh_nox_EF_SSF_stove <- dom_heat_EFs[1,3]
dh_nox_EF_SSF_boiler <- dom_heat_EFs[2,3]
dh_nox_EF_gasoil_boiler <- dom_heat_EFs[3,3]
dh_nox_EF_gas_boiler <- dom_heat_EFs[4,3]
dh_nox_EF_woodpellet_boiler <- dom_heat_EFs[5,3]
dh_nox_EF_wood_boiler <- dom_heat_EFs[6,3]
dh_nox_EF_wood_fireplace <- dom_heat_EFs[7,3]
dh_nox_EF_hydrogen_boiler <- dom_heat_EFs[8,3]
dh_nox_EF_hydrogen_natgas_boiler <- dom_heat_EFs[9,3]
dh_nox_EF_coal_stove <- dom_heat_EFs[10,3]

# Domestic Heat PM2.5 Emission Factors
dh_pm25_EF_SSF_stove <- dom_heat_EFs[1,4]
dh_pm25_EF_SSF_boiler <- dom_heat_EFs[2,4]
dh_pm25_EF_gasoil_boiler <- dom_heat_EFs[3,4]
dh_pm25_EF_gas_boiler <- dom_heat_EFs[4,4]
dh_pm25_EF_woodpellet_boiler <- dom_heat_EFs[5,4]
dh_pm25_EF_wood_boiler <- dom_heat_EFs[6,4]
dh_pm25_EF_wood_fireplace <- dom_heat_EFs[7,4]
dh_pm25_EF_hydrogen_boiler <- dom_heat_EFs[8,4]
dh_pm25_EF_hydrogen_natgas_boiler <- dom_heat_EFs[9,4]
dh_pm25_EF_coal_stove <- dom_heat_EFs[10,4]

#pNOx Domestic Heat Impact Factors
dh_nox_IF_coal <- impact_factors[7,7]
dh_nox_IF_gas <- impact_factors[8,7]
dh_nox_IF_oil <- impact_factors[9,7]
dh_nox_IF_wood <- impact_factors[10,7]

#PM2.5 Domestic Heat Impact Factors
dh_pm25_IF_coal <- impact_factors[7,6]
dh_pm25_IF_gas <- impact_factors[8,6]
dh_pm25_IF_oil <- impact_factors[9,6]
dh_pm25_IF_wood <- impact_factors[10,6]

#################################################################################################

# Building Heating Emission and Impact Factors
# Public and Commercial Heat CO2 Emission Factors
ph_co2_EF_coal_boiler <- pub_heat_EFs[1,2]
ph_co2_EF_fueloil_boiler <- pub_heat_EFs[2,2]
ph_co2_EF_gas_boiler <- pub_heat_EFs[3,2]
ph_co2_EF_biomass_boiler <- pub_heat_EFs[4,2]
ph_co2_EF_hydrogen_natgas_boiler <- pub_heat_EFs[5,2]
ph_co2_EF_hydrogen_boiler <- pub_heat_EFs[6,2]

# Public and Commercial Heat NOx Emission Factors
ph_nox_EF_coal_boiler <- pub_heat_EFs[1,3]
ph_nox_EF_fueloil_boiler <- pub_heat_EFs[2,3]
ph_nox_EF_gas_boiler <- pub_heat_EFs[3,3]
ph_nox_EF_biomass_boiler <- pub_heat_EFs[4,3]
ph_nox_EF_hydrogen_natgas_boiler <- pub_heat_EFs[5,3]
ph_nox_EF_hydrogen_boiler <- pub_heat_EFs[6,3]

# Public and Commercial Heat PM2.5 Emission Factors
ph_pm25_EF_coal_boiler <- pub_heat_EFs[1,4]
ph_pm25_EF_fueloil_boiler <- pub_heat_EFs[2,4]
ph_pm25_EF_gas_boiler <- pub_heat_EFs[3,4]
ph_pm25_EF_biomass_boiler <- pub_heat_EFs[4,4]
ph_pm25_EF_hydrogen_natgas_boiler <- pub_heat_EFs[5,4]
ph_pm25_EF_hydrogen_boiler <- pub_heat_EFs[6,4]

#pNOx Public and Commercial Heat Impact Factors
ph_nox_IF_public <- impact_factors[11,7]

#PM2.5 Public and Commercial Heat Impact Factors
ph_pm25_IF_public <- impact_factors[11,6]

#################################################################################################

# Industrial Combustion Emission and Impact Factors
# Iron and Steel CO2 Emission Factors
ironsteel_co2_EF_coal <- ind_com_EFs[1,3]
ironsteel_co2_EF_coke <- ind_com_EFs[2,3]
ironsteel_co2_EF_fueloil <- ind_com_EFs[3,3]
ironsteel_co2_EF_gasoil <- ind_com_EFs[4,3]
ironsteel_co2_EF_lpg <- ind_com_EFs[5,3]
ironsteel_co2_EF_gas <- ind_com_EFs[6,3]
ironsteel_co2_EF_hydrogen <- ind_com_EFs[7,3]
ironsteel_co2_EF_biomass <- ind_com_EFs[8,3]

# Iron and Steel NOx Emission Factors
ironsteel_nox_EF_coal <- ind_com_EFs[1,4]
ironsteel_nox_EF_coke <- ind_com_EFs[2,4]
ironsteel_nox_EF_fueloil <- ind_com_EFs[3,4]
ironsteel_nox_EF_gasoil <- ind_com_EFs[4,4]
ironsteel_nox_EF_lpg <- ind_com_EFs[5,4]
ironsteel_nox_EF_gas <- ind_com_EFs[6,4]
ironsteel_nox_EF_hydrogen <- ind_com_EFs[7,4]
ironsteel_nox_EF_biomass <- ind_com_EFs[8,4]

# Iron and Steel PM2.5 Emission Factors
ironsteel_pm25_EF_coal <- ind_com_EFs[1,5]
ironsteel_pm25_EF_coke <- ind_com_EFs[2,5]
ironsteel_pm25_EF_fueloil <- ind_com_EFs[3,5]
ironsteel_pm25_EF_gasoil <- ind_com_EFs[4,5]
ironsteel_pm25_EF_lpg <- ind_com_EFs[5,5]
ironsteel_pm25_EF_gas <- ind_com_EFs[6,5]
ironsteel_pm25_EF_hydrogen <- ind_com_EFs[7,5]
ironsteel_pm25_EF_biomass <- ind_com_EFs[8,5]

# Iron and Steel Impact Factors
ironsteel_nox_IF <- impact_factors[14,7]
ironsteel_pm25_IF <- impact_factors[14,6]

#################################################################################################

# Non-ferrous metals Combustion Emission and Impact Factors
# Non-ferrous metals CO2 Emission Factors
nfm_co2_EF_coalauto <- ind_com_EFs[9,3]
ngm_co2_EF_coal <- ind_com_EFs[10,3]
nfm_co2_EF_fueloil <- ind_com_EFs[11,3]
nfm_co2_EF_gasoil <- ind_com_EFs[12,3]
nfm_co2_EF_gas <- ind_com_EFs[13,3]
nfm_co2_EF_hydrogen <- ind_com_EFs[14,3]
nfm_co2_EF_biomass <- ind_com_EFs[15,3]

# Non-ferrous metals NOx Emission Factors
nfm_nox_EF_coalauto <- ind_com_EFs[9,4]
ngm_nox_EF_coal <- ind_com_EFs[10,4]
nfm_nox_EF_fueloil <- ind_com_EFs[11,4]
nfm_nox_EF_gasoil <- ind_com_EFs[12,4]
nfm_nox_EF_gas <- ind_com_EFs[13,4]
nfm_nox_EF_hydrogen <- ind_com_EFs[14,4]
nfm_nox_EF_biomass <- ind_com_EFs[15,4]

# Non-ferrous metals PM2.5 Emission Factors
nfm_pm25_EF_coalauto <- ind_com_EFs[9,5]
ngm_pm25_EF_coal <- ind_com_EFs[10,5]
nfm_pm25_EF_fueloil <- ind_com_EFs[11,5]
nfm_pm25_EF_gasoil <- ind_com_EFs[12,5]
nfm_pm25_EF_gas <- ind_com_EFs[13,5]
nfm_pm25_EF_hydrogen <- ind_com_EFs[14,5]
nfm_pm25_EF_biomass <- ind_com_EFs[15,5]

# Non-ferrous metals Impact Factors
nfm_nox_IF <- impact_factors[21,7]
nfm_pm25_IF <- impact_factors[21,6]

#################################################################################################

# Hydrogen Production Emission Factors and Impact Factors
# Hydrogen CO2 Emission Factors
hyd_prod_co2_EF_grey <- hyd_prod_EFs[1,4]
hyd_prod_co2_EF_blue <- hyd_prod_EFs[2,4]
hyd_prod_co2_EF_blueFGR <- hyd_prod_EFs[3,4]
hyd_prod_co2_EF_biomass_gasification <- hyd_prod_EFs[4,4]

# Hydrogen NOx Emission Factors
hyd_prod_nox_EF_grey <- hyd_prod_EFs[1,6]
hyd_prod_nox_EF_blue <- hyd_prod_EFs[2,6]
hyd_prod_nox_EF_blueFGR <- hyd_prod_EFs[3,6]
hyd_prod_nox_EF_biomass_gasification <- hyd_prod_EFs[4,6]

# Hydrogen PM2.5 Emission Factors
hyd_prod_pm25_EF_grey <- hyd_prod_EFs[1,7]
hyd_prod_pm25_EF_blue <- hyd_prod_EFs[2,7]
hyd_prod_pm25_EF_blueFGR <- hyd_prod_EFs[3,7]
hyd_prod_pm25_EF_biomass_gasification <- hyd_prod_EFs[4,7]


# Hydrogen production Impact Factors - Using small_power_gas as a proxy!
hyd_prod_nox_IF_Gas <- impact_factors[1,7]
hyd_prod_pm25_IF_Gas <- impact_factors[1,6]


# Variables for initial selection

sectors <- c("Electricity Generation", "Building Heating", "Industrial Combustion")
data_levels_Heating <- c("N/A", "Technologic-specific energy demand (e.g., electricity demand from heat pumps for building heating)", "Number of technologies installed (e.g., number of heat pumps installed)", "Overall sectoral energy demand (e.g., hydrogen demand for building heating)")
data_levels_Industrial <- c("N/A", "Process-specific energy demand (e.g., electricity demand for Iron & Steel)", "Overall sectoral energy demand (e.g., hydrogen demand for industrial combustion)" )
countries <- c("UK", "England", "Wales", "Scotland", "Northern Ireland")
impact_factor_choice <- c("UK", "England", "Wales", "Scotland", "Northern Ireland")
units <- c("TWh", "GWh", "PJ", "TJ", "GJ")
lifecycle_data <- c("Electricity Generation", "Hydrogen Production", "None of the above")

# Initial Selection Criteria

library(shiny)
library(shinydashboard)
library(shinydashboardPlus)
library(ggplot2)
library(plotly)
library(tidyverse)
library(dplyr)
library(reshape2)

ui <- dashboardPage(skin = "purple",
  
  dashboardHeader(title = "CAPSAM"),
  
  dashboardSidebar(
    
    
  
  sidebarMenu(
    menuItem("Scenario Questions and Upload", tabName = "upload", icon = icon("upload")),
    menuItem("About CAPSAM", tabName = "about", icon = icon("about"))
    
  )
  ),
  
  dashboardBody(
    
    
    
    
    
    
    fluidRow(
      
      tabBox(title = "Data Input",
             
             tabPanel("Scenario Questions",
         # Selecting which sectors are present in each scenario
         checkboxGroupInput("sectors", "Select all relevant sectors: ", choices = sectors),    
         # Deciding on basic levels of information for Building Heating
         selectInput("dataLevels", "Select the level of detail involved in the building heating scenario. If building heating is not included, select N/A.", choices = data_levels_Heating),    
         # Deciding on basic levels of information for Industrial Combustion
         selectInput("dataLevels", "Select the level of detail involved in the industrial combustion scenario. If industrial combustion is not included, select N/A.", choices = data_levels_Industrial),  
      
  
  ),
  
            tabPanel("Set Parameters and Import csv",
           
           # Selecting lifecycle aspects
           checkboxGroupInput("lifecycle", "What lifecycle information does your scenario contain? Select all relevant boxes", choices = lifecycle_data),
  
           # Selecting base and end years
          numericInput("baseYear", "What is your base (initial) year of your scenario?", value = 0),
          numericInput("endYear", "What is the end year of your scenario?", value = 0),  
           
         # Selecting units found in each scenario
          selectInput("units", "Please Select the Units used within your scenario: ", choices = units),
  
          # Inputting elec gen CSV input
          fileInput("elec_file", "Select your electricity generation file: "),
         
         # Inputting domestic heat csv input
         fileInput("dh_file", "Select your domestic combustion file: "),
         
         # Inputting public and commercial heat csv input
         fileInput("ph_file", "Select your public and commercial combustion file: "),
         
         # Inputting industrial combustion csv file
         fileInput("ind_file", "Select your industrial combustion file: "),
         
         # Inputting Hydrogen production csv file
         fileInput("hyd_file", "Select your hydrogen production file: "),
           
          actionButton("simulate", "Simulate")
    
  )),
  
          tabBox(title = "CSV Download",
           tabPanel("Electricity Generation Template Download", 
                    downloadButton("elec_template_download", "Electricity Generation Template")),
           tabPanel("Domestic Heating Template Download", 
                    downloadButton("dh_template_download_pure", "Technology-specific Domestic Heating Template"),
                    downloadButton("dh_template_download_vector", "Energy Vector Domestic Heating Template"),
                    downloadButton("dh_template_download_houses", "Number of Houses Domestic Heating Template")),
           tabPanel("Public and Commercial Heating Template Download", 
                    downloadButton("ph_template_download_pure", "Technology-specific Public Heating Template"),
                    downloadButton("ph_template_download_vector", "Energy Vector Public Heating Template"),
                    downloadButton("ph_template_download_houses", "Number of Houses Public Heating Template")),
           tabPanel("Industrial Combustion Template Download", 
                    downloadButton("ind_template_download_pure", "Sector-specific industrial combustion Template"),
                    downloadButton("ind_template_download_vector", "Energy Vector industrial combustion Template")),
           tabPanel("Hydrogen Production Template Download", 
                    downloadButton("hyd_template_download", "Hydrogen Production Template"))),
  
  
  
  ),
  

    

  
  fluidRow(
  
  tabBox(title = "Results", width = 12,
    
    tabPanel("Electricity", fluidRow(splitLayout(cellWidths = c("33%", "33%", "33%"), plotlyOutput("elec_co2"), plotlyOutput("elec_nox"), plotlyOutput("elec_pm25"), downloadButton("download_elec_co2", "Download")))),
    tabPanel("Domestic Heating", fluidRow(splitLayout(cellWidths = c("33%", "33%", "33%"), plotlyOutput("dh_co2"), plotlyOutput("dh_nox"), plotlyOutput("dh_pm25")))),
    tabPanel("Public and Commercial Heating", fluidRow(splitLayout(cellWidths = c("33%", "33%", "33%"), plotlyOutput("ph_co2"), plotlyOutput("ph_nox"), plotlyOutput("ph_pm25")))),
    tabPanel("Hydrogen Production", fluidRow(splitLayout(cellWidths = c("33%", "33%", "33%"), plotlyOutput("hydrogen_co2"), plotlyOutput("hydrogen_nox"), plotlyOutput("hydrogen_pm25")))),
    tabPanel("Iron & Steel", fluidRow(splitLayout(cellWidths = c("33%", "33%", "33%"), plotlyOutput("ironsteel_co2"), plotlyOutput("ironsteel_nox"), plotlyOutput("ironsteel_pm25")))),
    tabPanel("Non-Ferrous Metals", fluidRow(splitLayout(cellWidths = c("33%", "33%", "33%"), plotlyOutput("nfm_co2"), plotlyOutput("nfm_nox"), plotlyOutput("nfm_pm25")))),
    tabPanel("Chemicals", fluidRow(splitLayout(cellWidths = c("33%", "33%", "33%"), plotlyOutput("chem_co2"), plotlyOutput("chem_nox"), plotlyOutput("chem_pm25")))),
    tabPanel("Paper and Pulp", fluidRow(splitLayout(cellWidths = c("33%", "33%", "33%"), plotlyOutput("PaP_co2"), plotlyOutput("PaP_nox"), plotlyOutput("PaP_pm25")))),
    tabPanel("Food and Beverages", fluidRow(splitLayout(cellWidths = c("33%", "33%", "33%"), plotlyOutput("food_co2"), plotlyOutput("food_nox"), plotlyOutput("food_pm25")))),
    tabPanel("Minerals", fluidRow(splitLayout(cellWidths = c("33%", "33%", "33%"), plotlyOutput("min_co2"), plotlyOutput("min_nox"), plotlyOutput("min_pm25")))),
    tabPanel("Textiles and Leather", fluidRow(splitLayout(cellWidths = c("33%", "33%", "33%"), plotlyOutput("text_co2"), plotlyOutput("text_nox"), plotlyOutput("text_pm25")))),
    tabPanel("Construction/NRMM", fluidRow(splitLayout(cellWidths = c("33%", "33%", "33%"), plotlyOutput("con_co2"), plotlyOutput("con_nox"), plotlyOutput("con_pm25")))),
    
    # Other Industries - 1A2gviii - Mech Eng, Elec Eng, Vehicles, Other Ind
    tabPanel("Other Industries", fluidRow(splitLayout(cellWidths = c("33%", "33%", "33%"), plotlyOutput("other_co2"), plotlyOutput("other_nox"), plotlyOutput("other_pm25")))),
  
  )),
        
  
  
  
    
  ),
  
  
  
)

# Server-side logic

server <- function(input, output, session) {
  
     input_elec_file <- reactive({
      
     if(is.null(input$elec_file)) {
        return("")
      }
    
      input_elec_file <- read.csv(file = input$elec_file$datapath, fileEncoding='UTF-8-BOM', header = FALSE)
        
        colnames <- as.character(input_elec_file[ , 1])
        input_elec_file = data.frame(t(input_elec_file[ , -1])) 
        colnames(input_elec_file) <- colnames
        
        return(input_elec_file)
    })
  
     input_dh_file <- reactive({
      
      if(is.null(input$dh_file)) {
        return("")
      }
    
     input_dh_file <- read.csv(file = input$dh_file$datapath, fileEncoding='UTF-8-BOM', header = FALSE)
     
     colnames <- as.character(input_dh_file[ , 1])
     input_dh_file = data.frame(t(input_dh_file[ , -1]))
     colnames(input_dh_file) <- colnames
     
     return(input_dh_file)
    
    })
    
     input_ph_file <- reactive({
      
       if(is.null(input$ph_file)) {
        return("")
      }
    
      # reading input file now on server side
      input_ph_file <- read.csv(file = input$ph_file$datapath, fileEncoding='UTF-8-BOM', header = FALSE)
      
      colnames <- as.character(input_ph_file[ , 1])
      input_ph_file = data.frame(t(input_ph_file[ , -1]))
      colnames(input_ph_file) <- colnames
      
      return(input_ph_file)
    
    })
     
     input_ind_file <- reactive({
       
      if(is.null(input$ind_file)) {
        
        return("")
      }
       
       input_ind_file <- read.csv(file = input$ind_file$datapath, fileEncoding = 'UTF-8-BOM', header = FALSE)
       
       colnames <- as.character(input_ind_file[ , 1])
       input_ind_file = data.frame(t(input_ind_file[ , -1]))
       colnames(input_ind_file) <- colnames
      
       return(input_ind_file)
       
     })
     
     input_hyd_file <- reactive({
       
       if(is.null(input$hyd_file)) {
         
         return("")
         
       }
       
       input_hyd_file <- read.csv(file = input$hyd_file$datapath, fileEncoding = 'UTF-8-BOM', header = FALSE)
       
       colnames <- as.character(input_hyd_file[ , 1])
       input_hyd_file = data.frame(t(input_hyd_file[ , -1]))
       colnames(input_hyd_file) <- colnames
      
       return(input_hyd_file)
       
     })
     
     elec_data_sum <- reactive({
       
       req(input_elec_file())
       
       elec_data_sum <- rowSums(input_elec_file()[, 2:16], na.rm = TRUE)
       
       return(elec_data_sum)
       
     })
     
     dh_data_sum <- reactive({
       
       req(input_dh_file())
       
       dh_data_sum <- rowSums(input_dh_file()[, 2:28], na.rm = TRUE)
       
       return(dh_data_sum)
       
     })
     
     ph_data_sum <- reactive({
       
       req(input_ph_file())
       
       ph_data_sum <- rowSums(input_ph_file()[, 2:28], na.rm = TRUE)
       
       return(ph_data_sum)
       
     })
     
     hyd_data_sum <- reactive({
       
       req(input_hyd_file())
       
       hyd_data_sum <- rowSums(input_hyd_file()[, 2:7], na.rm = TRUE)
       
       return(hyd_data_sum)
     })
     
     ironsteel_data <- reactive({
       
       req(input_ind_file)
       
       ironsteel_data <- input_ind_file()[,1:6]
       
     })
     
     ironsteel_data_sum <- reactive({
       
       req(ironsteel_data())
       
       ironsteel_data_sum <- rowSums(ironsteel_data()[2:6], na.rm = TRUE)
       
       return(ironsteel_data_sum)
     })
     
     nfm_data <- reactive({
       
       req(input_ind_file())
       
       nfm_data <- input_ind_file()[, c(1,7:11)]
     })
     
     nfm_data_sum <- reactive({
       
       req(nfm_data())
       
       nfm_data_sum <- rowSums(nfm_data()[7:11], na.rm = TRUE)
       
       return(nfm_data_sum)
     })
   
###########################################################################################################################################
     
     # CSV Template Downloads
     
     output$elec_template_download <- downloadHandler(
       
       filename <- function(){
         "Elec_Template.csv"
       },
       
       content <- function(file) {
         file.copy("C:/Users/ab22/OneDrive - Imperial College London/Second Year Thesis/CAPSAM_CSVs/Templates/Elec_Template.csv", file)
       }
     )
     
     
     output$dh_template_download_pure <- downloadHandler(
       
       filename <- function(){
         "DomHeat_Template_FullData.csv"
       },
       
       content <- function(file) {
         file.copy("C:/Users/ab22/OneDrive - Imperial College London/Second Year Thesis/CAPSAM_CSVs/Templates/DomHeat_Template_FullData.csv", file)
       }
     )
     
     output$ph_template_download_pure <- downloadHandler(
       
       filename <- function(){
         "PubHeat_Template_FullData.csv"
       },
       
       content <- function(file) {
         file.copy("C:/Users/ab22/OneDrive - Imperial College London/Second Year Thesis/CAPSAM_CSVs/Templates/PubHeat_Template_FullData.csv", file)
       }
     )
     
     output$ind_template_download_pure <- downloadHandler(
       
       filename <- function(){
         "Industry_Template_FullData.csv"
       },
       
       content <- function(file) {
         file.copy("C:/Users/ab22/OneDrive - Imperial College London/Second Year Thesis/CAPSAM_CSVs/Templates/Industry_Template_FullData.csv", file)
       }
     )
     
     output$hyd_template_download <- downloadHandler(
       
       filename <- function(){
         "Hydrogen_Template.csv"
       },
       
       content <- function(file) {
         file.copy("C:/Users/ab22/OneDrive - Imperial College London/Second Year Thesis/CAPSAM_CSVs/Templates/Hydrogen_Template.csv", file)
       }
     )
     
#################################################################################################################################################################     
     
     
     # Electricity Generation
     
  # CO2 Emissions - line plot from elec gen (flipped to long)
   
     output$elec_co2 <- renderPlotly({
        
      req(input_elec_file())
      
       df_elec_co2_emissions <- input_elec_file()[, 1:9]
       
       df_elec_co2_emissions$Biomass <- df_elec_co2_emissions$Biomass * elec_co2_EF_Biomass
       df_elec_co2_emissions$BECCS <- df_elec_co2_emissions$BECCS * elec_co2_EF_BECCS
       df_elec_co2_emissions$Gas <- df_elec_co2_emissions$Gas * elec_co2_EF_Gas
       df_elec_co2_emissions$`Gas CCS` <- df_elec_co2_emissions$`Gas CCS` * elec_co2_EF_GasCCS
       df_elec_co2_emissions$Hydrogen <- df_elec_co2_emissions$Hydrogen * elec_co2_EF_Hydrogen
       df_elec_co2_emissions$Coal <- df_elec_co2_emissions$Coal * elec_co2_EF_Coal
       df_elec_co2_emissions$Waste <- df_elec_co2_emissions$Waste * elec_co2_EF_Waste
       df_elec_co2_emissions$`Other thermal` <- df_elec_co2_emissions$`Other thermal` * elec_co2_EF_OtherThermal
       df_elec_co2_emissions$`Total Emissions` <- rowSums(df_elec_co2_emissions[,2:9], na.rm = TRUE)
       
       
       # <<- to make global and allow for download as melted format!
       long_df_elec_co2_emissions <<- melt(df_elec_co2_emissions[, 1:9], id.vars = "Year", variable.name = "Source", value.name = "Emissions", na.rm = TRUE)

   
        p <- ggplot(long_df_elec_co2_emissions,
               aes(Year, Emissions, col = Source)) +
        geom_line() + 
        labs(y = "CO2 Emissions (kt)")
        
        ggplotly(p)
        
        
     })
     
     output$download_elec_co2 <- downloadHandler(
       filename = function(){
         paste("elec_co2_data-", Sys.Date(), ".csv", sep = "")
       },
       
       content = function(file) {
         write.csv(long_df_elec_co2_emissions, file)
       }
     )
     
     #########################################################################################################
     
     
     # NOx PWMC Impacts (currently not weighted per unit energy)
     
     
      output$elec_nox <- renderPlotly({
        
      req(input_elec_file())
     
       df_elec_nox_emissions <- input_elec_file()[, 1:9]
       
       df_elec_nox_emissions$Biomass <- df_elec_nox_emissions$Biomass * elec_nox_EF_Biomass
       df_elec_nox_emissions$BECCS <- df_elec_nox_emissions$BECCS * elec_nox_EF_BECCS
       df_elec_nox_emissions$Gas <- df_elec_nox_emissions$Gas * elec_nox_EF_Gas
       df_elec_nox_emissions$`Gas CCS` <- df_elec_nox_emissions$`Gas CCS` * elec_nox_EF_GasCCS
       df_elec_nox_emissions$Hydrogen <- df_elec_nox_emissions$Hydrogen * elec_nox_EF_Hydrogen
       df_elec_nox_emissions$Coal <- df_elec_nox_emissions$Coal * elec_nox_EF_Coal
       df_elec_nox_emissions$Waste <- df_elec_nox_emissions$Waste * elec_nox_EF_Waste
       df_elec_nox_emissions$`Other thermal` <- df_elec_nox_emissions$`Other thermal` * elec_nox_EF_OtherThermal
       df_elec_nox_emissions$`Total Emissions` <- rowSums(df_elec_nox_emissions[, 2:9], na.rm = TRUE)
       
       # Producing PWMC Impacts using UK-to-UK impact factors 
       df_elec_nox_impacts <- df_elec_nox_emissions[,1:9]

       # pNOx Impacts from electricity generation
       df_elec_nox_impacts$Biomass <- df_elec_nox_impacts$Biomass * elec_nox_IF_Other
       df_elec_nox_impacts$BECCS <- df_elec_nox_impacts$BECCS * elec_nox_IF_Other
       df_elec_nox_impacts$Gas <- df_elec_nox_impacts$Gas * elec_nox_IF_Gas
       df_elec_nox_impacts$`Gas CCS` <- df_elec_nox_impacts$`Gas CCS` * elec_nox_IF_Gas
       df_elec_nox_impacts$Hydrogen <- df_elec_nox_impacts$Hydrogen * elec_nox_IF_Gas
       df_elec_nox_impacts$Coal <- df_elec_nox_impacts$Coal * elec_nox_IF_Other
       df_elec_nox_impacts$Waste <- df_elec_nox_impacts$Waste * elec_nox_IF_Other
       df_elec_nox_impacts$`Other thermal` <- df_elec_nox_impacts$`Other thermal` * elec_nox_IF_Other
       df_elec_nox_impacts$`Total Impact` <- rowSums(df_elec_nox_impacts[, 2:9], na.rm = TRUE) 
       
       
       long_df_elec_nox_impacts <- melt(df_elec_nox_impacts[, 1:9], id.vars = "Year", variable.name = "Source", value.name = "PWMC", na.rm = TRUE)

   
        p <- ggplot(long_df_elec_nox_impacts, aes(Year, PWMC, col = Source)) +
        geom_line() + 
        labs(y = "NOx PWMC Impact (ng m-3)")
        
        ggplotly(p)
        
        
     })   
     
      #########################################################################################################
     
     # PM2.5 PWMC Impacts (currently not weighted per unit energy)
     
     output$elec_pm25 <- renderPlotly({
        
      req(input_elec_file())
   
       df_elec_pm25_emissions <- input_elec_file()[, 1:9]
       
       df_elec_pm25_emissions$Biomass <- df_elec_pm25_emissions$Biomass * elec_pm25_EF_Biomass
       df_elec_pm25_emissions$BECCS <- df_elec_pm25_emissions$BECCS * elec_pm25_EF_BECCS
       df_elec_pm25_emissions$Gas <- df_elec_pm25_emissions$Gas * elec_pm25_EF_Gas
       df_elec_pm25_emissions$`Gas CCS` <- df_elec_pm25_emissions$`Gas CCS` * elec_pm25_EF_GasCCS
       df_elec_pm25_emissions$Hydrogen <- df_elec_pm25_emissions$Hydrogen * elec_pm25_EF_Hydrogen
       df_elec_pm25_emissions$Coal <- df_elec_pm25_emissions$Coal * elec_pm25_EF_Coal
       df_elec_pm25_emissions$Waste <- df_elec_pm25_emissions$Waste * elec_pm25_EF_Waste
       df_elec_pm25_emissions$`Other thermal` <- df_elec_pm25_emissions$`Other thermal` * elec_pm25_EF_OtherThermal
       df_elec_pm25_emissions$`Total Emissions` <- rowSums(df_elec_pm25_emissions[, 2:9], na.rm = TRUE)
       
       # Producing PWMC Impacts using UK-to-UK impact factors 
       df_elec_pm25_impacts <- df_elec_pm25_emissions[,1:9]

       # pNOx Impacts from electricity generation
       df_elec_pm25_impacts$Biomass <- df_elec_pm25_impacts$Biomass * elec_pm25_IF_Other
       df_elec_pm25_impacts$BECCS <- df_elec_pm25_impacts$BECCS * elec_pm25_IF_Other
       df_elec_pm25_impacts$Gas <- df_elec_pm25_impacts$Gas * elec_pm25_IF_Gas
       df_elec_pm25_impacts$`Gas CCS` <- df_elec_pm25_impacts$`Gas CCS` * elec_pm25_IF_Gas
       df_elec_pm25_impacts$Hydrogen <- df_elec_pm25_impacts$Hydrogen * elec_pm25_IF_Gas
       df_elec_pm25_impacts$Coal <- df_elec_pm25_impacts$Coal * elec_pm25_IF_Other
       df_elec_pm25_impacts$Waste <- df_elec_pm25_impacts$Waste * elec_pm25_IF_Other
       df_elec_pm25_impacts$`Other thermal` <- df_elec_pm25_impacts$`Other thermal` * elec_pm25_IF_Other
       df_elec_pm25_impacts$`Total Impact` <- rowSums(df_elec_pm25_impacts[, 2:9], na.rm = TRUE)
       
       
       long_df_elec_pm25_impacts <- melt(df_elec_pm25_impacts[, 1:9], id.vars = "Year", variable.name = "Source", value.name = "PWMC", na.rm = TRUE)

   
        p <- ggplot(long_df_elec_pm25_impacts, aes(Year, PWMC, col = Source)) +
        geom_line() + 
        labs(y = "PM2.5 PWMC Impact (ng m-3)")
        
        ggplotly(p)
        
        
     })   
     
     ###################################################################################################################################################
     
     # Domestic Heating
     
     # Domestic Heating CO2 Emissions
     
     output$dh_co2 <- renderPlotly({
       
       req(input_dh_file())
       
       df_dh_co2_emissions <- input_dh_file()[, 1:17]
       
       df_dh_co2_emissions$`Biofuel Boiler` <- df_dh_co2_emissions$`Biofuel Boiler` * dh_co2_EF_gasoil_boiler
       df_dh_co2_emissions$`ASHP + Biofuel Boiler (Biofuel)` <- df_dh_co2_emissions$`ASHP + Biofuel Boiler (Biofuel)` * dh_co2_EF_gasoil_boiler
       df_dh_co2_emissions$`Biomass Boiler` <- df_dh_co2_emissions$`Biomass Boiler` * dh_co2_EF_woodpellet_boiler
       df_dh_co2_emissions$`Biomass CHP` <- df_dh_co2_emissions$`Biomass CHP` * ph_co2_EF_biomass_boiler
       df_dh_co2_emissions$`District Heating (Biomass)` <- df_dh_co2_emissions$`District Heating (Biomass)` * ph_co2_EF_biomass_boiler
       df_dh_co2_emissions$`District Heating (Biomethane)` <- df_dh_co2_emissions$`District Heating (Biomethane)` * ph_co2_EF_gas_boiler
       df_dh_co2_emissions$`District Heating (Gas)` <- df_dh_co2_emissions$`District Heating (Gas)` * ph_co2_EF_gas_boiler
       df_dh_co2_emissions$`Gas Boiler` <- df_dh_co2_emissions$`Gas Boiler` * dh_co2_EF_gas_boiler
       df_dh_co2_emissions$`Gas CHP` <- df_dh_co2_emissions$`Gas CHP` * ph_co2_EF_gas_boiler
       df_dh_co2_emissions$`District Heating (Hydrogen)` <- df_dh_co2_emissions$`District Heating (Hydrogen)` * ph_co2_EF_hydrogen_boiler
       df_dh_co2_emissions$`Gas Boiler - H2-NG Blend` <- df_dh_co2_emissions$`Gas Boiler - H2-NG Blend` * dh_co2_EF_hydrogen_natgas_boiler
       df_dh_co2_emissions$`Gas CHP - H2-NG Blend` <- df_dh_co2_emissions$`Gas CHP - H2-NG Blend` * ph_co2_EF_hydrogen_natgas_boiler
       df_dh_co2_emissions$`ASHP + Hydrogen Boiler (Hydrogen)` <- df_dh_co2_emissions$`ASHP + Hydrogen Boiler (Hydrogen)` * dh_co2_EF_hydrogen_boiler
       df_dh_co2_emissions$`Hydrogen Boiler` <- df_dh_co2_emissions$`Hydrogen Boiler` * dh_co2_EF_hydrogen_boiler
       df_dh_co2_emissions$`Oil Boiler` <- df_dh_co2_emissions$`Oil Boiler` * dh_co2_EF_gasoil_boiler
       df_dh_co2_emissions$`Community Heating` <- df_dh_co2_emissions$`Community Heating` * ph_co2_EF_fueloil_boiler
       df_dh_co2_emissions$`Total Emissions` <- rowSums(df_dh_co2_emissions[, 2:17], na.rm = TRUE)
       
       
       long_df_dh_co2_emissions <- melt(df_dh_co2_emissions[, 1:17], id.vars = "Year", variable.name = "Source", value.name = "Emissions", na.rm = TRUE)
       
       p <- ggplot(long_df_dh_co2_emissions, aes(Year, Emissions, col = Source)) +
                geom_line() + 
                labs(y = "CO2 Emissions (kt)")
       
       ggplotly(p)
       
       
       
     })
 
     
     ###############################################################################################################     
     
     # Domestic Heating NOx Emissions
     
     output$dh_nox <- renderPlotly({
       
       req(input_dh_file())

       df_dh_nox_emissions <- input_dh_file()[, 1:17]
       
       df_dh_nox_emissions$`Biofuel Boiler` <- df_dh_nox_emissions$`Biofuel Boiler` * dh_nox_EF_gasoil_boiler
       df_dh_nox_emissions$`ASHP + Biofuel Boiler (Biofuel)` <- df_dh_nox_emissions$`ASHP + Biofuel Boiler (Biofuel)` * dh_nox_EF_gasoil_boiler
       df_dh_nox_emissions$`Biomass Boiler` <- df_dh_nox_emissions$`Biomass Boiler` * dh_nox_EF_woodpellet_boiler
       df_dh_nox_emissions$`Biomass CHP` <- df_dh_nox_emissions$`Biomass CHP` * ph_nox_EF_biomass_boiler
       df_dh_nox_emissions$`District Heating (Biomass)` <- df_dh_nox_emissions$`District Heating (Biomass)` * ph_nox_EF_biomass_boiler
       df_dh_nox_emissions$`District Heating (Biomethane)` <- df_dh_nox_emissions$`District Heating (Biomethane)` * ph_nox_EF_gas_boiler
       df_dh_nox_emissions$`District Heating (Gas)` <- df_dh_nox_emissions$`District Heating (Gas)` * ph_nox_EF_gas_boiler
       df_dh_nox_emissions$`Gas Boiler` <- df_dh_nox_emissions$`Gas Boiler` * dh_nox_EF_gas_boiler
       df_dh_nox_emissions$`Gas CHP` <- df_dh_nox_emissions$`Gas CHP` * ph_nox_EF_gas_boiler
       df_dh_nox_emissions$`District Heating (Hydrogen)` <- df_dh_nox_emissions$`District Heating (Hydrogen)` * ph_nox_EF_hydrogen_boiler
       df_dh_nox_emissions$`Gas Boiler - H2-NG Blend` <- df_dh_nox_emissions$`Gas Boiler - H2-NG Blend` * dh_nox_EF_hydrogen_natgas_boiler
       df_dh_nox_emissions$`Gas CHP - H2-NG Blend` <- df_dh_nox_emissions$`Gas CHP - H2-NG Blend` * ph_nox_EF_hydrogen_natgas_boiler
       df_dh_nox_emissions$`ASHP + Hydrogen Boiler (Hydrogen)` <- df_dh_nox_emissions$`ASHP + Hydrogen Boiler (Hydrogen)` * dh_nox_EF_hydrogen_boiler
       df_dh_nox_emissions$`Hydrogen Boiler` <- df_dh_nox_emissions$`Hydrogen Boiler` * dh_nox_EF_hydrogen_boiler
       df_dh_nox_emissions$`Oil Boiler` <- df_dh_nox_emissions$`Oil Boiler` * dh_nox_EF_gasoil_boiler
       df_dh_nox_emissions$`Community Heating` <- df_dh_nox_emissions$`Community Heating` * ph_nox_EF_fueloil_boiler
       df_dh_nox_emissions$`Total Emissions` <- rowSums(df_dh_nox_emissions[, 2:17], na.rm = TRUE)
       
       
       # pNOx PWMC Impacts
       
       df_dh_nox_impacts <- df_dh_nox_emissions[, 1:17]
       
       df_dh_nox_impacts$`Biofuel Boiler` <- df_dh_nox_impacts$`Biofuel Boiler` * dh_nox_IF_oil
       df_dh_nox_impacts$`ASHP + Biofuel Boiler (Biofuel)` <- df_dh_nox_impacts$`ASHP + Biofuel Boiler (Biofuel)` * dh_nox_IF_oil
       df_dh_nox_impacts$`Biomass Boiler` <- df_dh_nox_impacts$`Biomass Boiler` * dh_nox_IF_wood
       df_dh_nox_impacts$`Biomass CHP` <- df_dh_nox_impacts$`Biomass CHP` * ph_nox_IF_public
       df_dh_nox_impacts$`District Heating (Biomass)` <- df_dh_nox_impacts$`District Heating (Biomass)` * ph_nox_IF_public
       df_dh_nox_impacts$`District Heating (Biomethane)` <- df_dh_nox_impacts$`District Heating (Biomethane)` * ph_nox_IF_public
       df_dh_nox_impacts$`District Heating (Gas)` <- df_dh_nox_impacts$`District Heating (Gas)` * ph_nox_IF_public
       df_dh_nox_impacts$`Gas Boiler` <- df_dh_nox_impacts$`Gas Boiler` * dh_nox_IF_gas
       df_dh_nox_impacts$`Gas CHP` <- df_dh_nox_impacts$`Gas CHP` * ph_nox_IF_public
       df_dh_nox_impacts$`District Heating (Hydrogen)` <- df_dh_nox_impacts$`District Heating (Hydrogen)` * ph_nox_IF_public
       df_dh_nox_impacts$`Gas Boiler - H2-NG Blend` <- df_dh_nox_impacts$`Gas Boiler - H2-NG Blend` * dh_nox_IF_gas
       df_dh_nox_impacts$`Gas CHP - H2-NG Blend` <- df_dh_nox_impacts$`Gas CHP - H2-NG Blend` * ph_nox_IF_public
       df_dh_nox_impacts$`ASHP + Hydrogen Boiler (Hydrogen)` <- df_dh_nox_impacts$`ASHP + Hydrogen Boiler (Hydrogen)` * dh_nox_IF_gas
       df_dh_nox_impacts$`Hydrogen Boiler` <- df_dh_nox_impacts$`Hydrogen Boiler` * dh_nox_IF_gas
       df_dh_nox_impacts$`Oil Boiler` <- df_dh_nox_impacts$`Oil Boiler` * dh_nox_IF_oil
       df_dh_nox_impacts$`Community Heating` <- df_dh_nox_impacts$`Community Heating` * ph_nox_IF_public
       df_dh_nox_impacts$`Total Emissions` <- rowSums(df_dh_nox_impacts[, 2:17], na.rm = TRUE)
       
       
       
       long_df_dh_nox_impacts <- melt(df_dh_nox_impacts[, 1:17], id.vars = "Year", variable.name = "Source", value.name = "Impacts", na.rm = TRUE)
       
       p <- ggplot(long_df_dh_nox_impacts, aes(Year, Impacts, col = Source)) +
                geom_line() + 
                labs(y = "NOx PWMC Impacts (ng m-3)")
       
       ggplotly(p)
       
     })
     
    
     
     ###################################################################################################################
     
     # Domestic PM2.5 Emissions
     
     output$dh_pm25 <- renderPlotly({
       
       req(input_dh_file())
       
       df_dh_pm25_emissions <- input_dh_file()[, 1:17]
       
       df_dh_pm25_emissions$`Biofuel Boiler` <- df_dh_pm25_emissions$`Biofuel Boiler` * dh_pm25_EF_gasoil_boiler
       df_dh_pm25_emissions$`ASHP + Biofuel Boiler (Biofuel)` <- df_dh_pm25_emissions$`ASHP + Biofuel Boiler (Biofuel)` * dh_pm25_EF_gasoil_boiler
       df_dh_pm25_emissions$`Biomass Boiler` <- df_dh_pm25_emissions$`Biomass Boiler` * dh_pm25_EF_woodpellet_boiler
       df_dh_pm25_emissions$`Biomass CHP` <- df_dh_pm25_emissions$`Biomass CHP` * ph_pm25_EF_biomass_boiler
       df_dh_pm25_emissions$`District Heating (Biomass)` <- df_dh_pm25_emissions$`District Heating (Biomass)` * ph_pm25_EF_biomass_boiler
       df_dh_pm25_emissions$`District Heating (Biomethane)` <- df_dh_pm25_emissions$`District Heating (Biomethane)` * ph_pm25_EF_gas_boiler
       df_dh_pm25_emissions$`District Heating (Gas)` <- df_dh_pm25_emissions$`District Heating (Gas)` * ph_pm25_EF_gas_boiler
       df_dh_pm25_emissions$`Gas Boiler` <- df_dh_pm25_emissions$`Gas Boiler` * dh_pm25_EF_gas_boiler
       df_dh_pm25_emissions$`Gas CHP` <- df_dh_pm25_emissions$`Gas CHP` * ph_pm25_EF_gas_boiler
       df_dh_pm25_emissions$`District Heating (Hydrogen)` <- df_dh_pm25_emissions$`District Heating (Hydrogen)` * ph_pm25_EF_hydrogen_boiler
       df_dh_pm25_emissions$`Gas Boiler - H2-NG Blend` <- df_dh_pm25_emissions$`Gas Boiler - H2-NG Blend` * dh_pm25_EF_hydrogen_natgas_boiler
       df_dh_pm25_emissions$`Gas CHP - H2-NG Blend` <- df_dh_pm25_emissions$`Gas CHP - H2-NG Blend` * ph_pm25_EF_hydrogen_natgas_boiler
       df_dh_pm25_emissions$`ASHP + Hydrogen Boiler (Hydrogen)` <- df_dh_pm25_emissions$`ASHP + Hydrogen Boiler (Hydrogen)` * dh_pm25_EF_hydrogen_boiler
       df_dh_pm25_emissions$`Hydrogen Boiler` <- df_dh_pm25_emissions$`Hydrogen Boiler` * dh_pm25_EF_hydrogen_boiler
       df_dh_pm25_emissions$`Oil Boiler` <- df_dh_pm25_emissions$`Oil Boiler` * dh_pm25_EF_gasoil_boiler
       df_dh_pm25_emissions$`Community Heating` <- df_dh_pm25_emissions$`Community Heating` * ph_pm25_EF_fueloil_boiler
       df_dh_pm25_emissions$`Total Emissions` <- rowSums(df_dh_pm25_emissions[, 2:17], na.rm = TRUE)
       
       
       # pNOx PWMC Impacts
       
       df_dh_pm25_impacts <- df_dh_pm25_emissions[, 1:17]
       
       df_dh_pm25_impacts$`Biofuel Boiler` <- df_dh_pm25_impacts$`Biofuel Boiler` * dh_nox_IF_oil
       df_dh_pm25_impacts$`ASHP + Biofuel Boiler (Biofuel)` <- df_dh_pm25_impacts$`ASHP + Biofuel Boiler (Biofuel)` * dh_nox_IF_oil
       df_dh_pm25_impacts$`Biomass Boiler` <- df_dh_pm25_impacts$`Biomass Boiler` * dh_nox_IF_wood
       df_dh_pm25_impacts$`Biomass CHP` <- df_dh_pm25_impacts$`Biomass CHP` * ph_nox_IF_public
       df_dh_pm25_impacts$`District Heating (Biomass)` <- df_dh_pm25_impacts$`District Heating (Biomass)` * ph_nox_IF_public
       df_dh_pm25_impacts$`District Heating (Biomethane)` <- df_dh_pm25_impacts$`District Heating (Biomethane)` * ph_nox_IF_public
       df_dh_pm25_impacts$`District Heating (Gas)` <- df_dh_pm25_impacts$`District Heating (Gas)` * ph_nox_IF_public
       df_dh_pm25_impacts$`Gas Boiler` <- df_dh_pm25_impacts$`Gas Boiler` * dh_nox_IF_gas
       df_dh_pm25_impacts$`Gas CHP` <- df_dh_pm25_impacts$`Gas CHP` * ph_nox_IF_public
       df_dh_pm25_impacts$`District Heating (Hydrogen)` <- df_dh_pm25_impacts$`District Heating (Hydrogen)` * ph_nox_IF_public
       df_dh_pm25_impacts$`Gas Boiler - H2-NG Blend` <- df_dh_pm25_impacts$`Gas Boiler - H2-NG Blend` * dh_nox_IF_gas
       df_dh_pm25_impacts$`Gas CHP - H2-NG Blend` <- df_dh_pm25_impacts$`Gas CHP - H2-NG Blend` * ph_nox_IF_public
       df_dh_pm25_impacts$`ASHP + Hydrogen Boiler (Hydrogen)` <- df_dh_pm25_impacts$`ASHP + Hydrogen Boiler (Hydrogen)` * dh_nox_IF_gas
       df_dh_pm25_impacts$`Hydrogen Boiler` <- df_dh_pm25_impacts$`Hydrogen Boiler` * dh_nox_IF_gas
       df_dh_pm25_impacts$`Oil Boiler` <- df_dh_pm25_impacts$`Oil Boiler` * dh_nox_IF_oil
       df_dh_pm25_impacts$`Community Heating` <- df_dh_pm25_impacts$`Community Heating` * ph_nox_IF_public
       df_dh_pm25_impacts$`Total Emissions` <- rowSums(df_dh_pm25_impacts[, 2:17], na.rm = TRUE)
       
       
       
       long_df_dh_pm25_impacts <- melt(df_dh_pm25_impacts[, 1:17], id.vars = "Year", variable.name = "Source", value.name = "Impacts", na.rm = TRUE)
       
       p <- ggplot(long_df_dh_pm25_impacts, aes(Year, Impacts, col = Source)) +
                geom_line() + 
                labs(y = "PM2.5 PWMC Impacts (ng m-3)")
      
       ggplotly(p)
       
     })
     
     
     ###################################################################################################################################################
     
     # Public and commercial Heating
     
     # Public and commercial Heating CO2 Emissions
     
     output$ph_co2 <- renderPlotly({
       
       req(input_ph_file())
       
       df_ph_co2_emissions <- input_ph_file()[, 1:17]
       
       df_ph_co2_emissions$`Biofuel Boiler` <- df_ph_co2_emissions$`Biofuel Boiler` * ph_co2_EF_fueloil_boiler
       df_ph_co2_emissions$`ASHP + Biofuel Boiler (Biofuel)` <- df_ph_co2_emissions$`ASHP + Biofuel Boiler (Biofuel)` * ph_co2_EF_fueloil_boiler
       df_ph_co2_emissions$`Biomass Boiler` <- df_ph_co2_emissions$`Biomass Boiler` * ph_co2_EF_biomass_boiler
       df_ph_co2_emissions$`Biomass CHP` <- df_ph_co2_emissions$`Biomass CHP` * ph_co2_EF_biomass_boiler
       df_ph_co2_emissions$`District Heating (Biomass)` <- df_ph_co2_emissions$`District Heating (Biomass)` * ph_co2_EF_biomass_boiler
       df_ph_co2_emissions$`District Heating (Biomethane)` <- df_ph_co2_emissions$`District Heating (Biomethane)` * ph_co2_EF_gas_boiler
       df_ph_co2_emissions$`District Heating (Gas)` <- df_ph_co2_emissions$`District Heating (Gas)` * ph_co2_EF_gas_boiler
       df_ph_co2_emissions$`Gas Boiler` <- df_ph_co2_emissions$`Gas Boiler` * ph_co2_EF_gas_boiler
       df_ph_co2_emissions$`Gas CHP` <- df_ph_co2_emissions$`Gas CHP` * ph_co2_EF_gas_boiler
       df_ph_co2_emissions$`District Heating (Hydrogen)` <- df_ph_co2_emissions$`District Heating (Hydrogen)` * ph_co2_EF_hydrogen_boiler
       df_ph_co2_emissions$`Gas Boiler - H2-NG Blend` <- df_ph_co2_emissions$`Gas Boiler - H2-NG Blend` * ph_co2_EF_hydrogen_natgas_boiler
       df_ph_co2_emissions$`Gas CHP - H2-NG Blend` <- df_ph_co2_emissions$`Gas CHP - H2-NG Blend` * ph_co2_EF_hydrogen_natgas_boiler
       df_ph_co2_emissions$`ASHP + Hydrogen Boiler (Hydrogen)` <- df_ph_co2_emissions$`ASHP + Hydrogen Boiler (Hydrogen)` * ph_co2_EF_hydrogen_boiler
       df_ph_co2_emissions$`Hydrogen Boiler` <- df_ph_co2_emissions$`Hydrogen Boiler` * ph_co2_EF_hydrogen_boiler
       df_ph_co2_emissions$`Oil Boiler` <- df_ph_co2_emissions$`Oil Boiler` * ph_co2_EF_fueloil_boiler
       df_ph_co2_emissions$`Community Heating` <- df_ph_co2_emissions$`Community Heating` * ph_co2_EF_fueloil_boiler
       df_ph_co2_emissions$`Total Emissions` <- rowSums(df_ph_co2_emissions[, 2:17], na.rm = TRUE)
       
       
       long_df_ph_co2_emissions <- melt(df_ph_co2_emissions[, 1:17], id.vars = "Year", variable.name = "Source", value.name = "Emissions", na.rm = TRUE)
       
       p <- ggplot(long_df_ph_co2_emissions, aes(Year, Emissions, col = Source)) +
                geom_line() + 
                labs(y = "CO2 Emissions (kt)")
       
       ggplotly(p)
       
       
     })
 
     
     ###############################################################################################################     
     
     # Public and commercial Heating NOx Emissions
     
     output$ph_nox <- renderPlotly({
       
       req(input_ph_file())
       
       df_ph_nox_emissions <- input_ph_file()[, 1:17]
       
       df_ph_nox_emissions$`Biofuel Boiler` <- df_ph_nox_emissions$`Biofuel Boiler` * ph_nox_EF_fueloil_boiler
       df_ph_nox_emissions$`ASHP + Biofuel Boiler (Biofuel)` <- df_ph_nox_emissions$`ASHP + Biofuel Boiler (Biofuel)` * ph_nox_EF_fueloil_boiler
       df_ph_nox_emissions$`Biomass Boiler` <- df_ph_nox_emissions$`Biomass Boiler` * ph_nox_EF_biomass_boiler
       df_ph_nox_emissions$`Biomass CHP` <- df_ph_nox_emissions$`Biomass CHP` * ph_nox_EF_biomass_boiler
       df_ph_nox_emissions$`District Heating (Biomass)` <- df_ph_nox_emissions$`District Heating (Biomass)` * ph_nox_EF_biomass_boiler
       df_ph_nox_emissions$`District Heating (Biomethane)` <- df_ph_nox_emissions$`District Heating (Biomethane)` * ph_nox_EF_gas_boiler
       df_ph_nox_emissions$`District Heating (Gas)` <- df_ph_nox_emissions$`District Heating (Gas)` * ph_nox_EF_gas_boiler
       df_ph_nox_emissions$`Gas Boiler` <- df_ph_nox_emissions$`Gas Boiler` * ph_nox_EF_gas_boiler
       df_ph_nox_emissions$`Gas CHP` <- df_ph_nox_emissions$`Gas CHP` * ph_nox_EF_gas_boiler
       df_ph_nox_emissions$`District Heating (Hydrogen)` <- df_ph_nox_emissions$`District Heating (Hydrogen)` * ph_nox_EF_hydrogen_boiler
       df_ph_nox_emissions$`Gas Boiler - H2-NG Blend` <- df_ph_nox_emissions$`Gas Boiler - H2-NG Blend` * ph_nox_EF_hydrogen_natgas_boiler
       df_ph_nox_emissions$`Gas CHP - H2-NG Blend` <- df_ph_nox_emissions$`Gas CHP - H2-NG Blend` * ph_nox_EF_hydrogen_natgas_boiler
       df_ph_nox_emissions$`ASHP + Hydrogen Boiler (Hydrogen)` <- df_ph_nox_emissions$`ASHP + Hydrogen Boiler (Hydrogen)` * ph_nox_EF_hydrogen_boiler
       df_ph_nox_emissions$`Hydrogen Boiler` <- df_ph_nox_emissions$`Hydrogen Boiler` * ph_nox_EF_hydrogen_boiler
       df_ph_nox_emissions$`Oil Boiler` <- df_ph_nox_emissions$`Oil Boiler` * ph_nox_EF_fueloil_boiler
       df_ph_nox_emissions$`Community Heating` <- df_ph_nox_emissions$`Community Heating` * ph_nox_EF_fueloil_boiler
       df_ph_nox_emissions$`Total Emissions` <- rowSums(df_ph_nox_emissions[, 2:17], na.rm = TRUE)
       
       
       # pNOx PWMC Impacts
       
       df_ph_nox_impacts <- df_ph_nox_emissions[, 1:17]
       
       df_ph_nox_impacts$`Biofuel Boiler` <- df_ph_nox_impacts$`Biofuel Boiler` * ph_nox_IF_public
       df_ph_nox_impacts$`ASHP + Biofuel Boiler (Biofuel)` <- df_ph_nox_impacts$`ASHP + Biofuel Boiler (Biofuel)` * ph_nox_IF_public
       df_ph_nox_impacts$`Biomass Boiler` <- df_ph_nox_impacts$`Biomass Boiler` * ph_nox_IF_public
       df_ph_nox_impacts$`Biomass CHP` <- df_ph_nox_impacts$`Biomass CHP` * ph_nox_IF_public
       df_ph_nox_impacts$`District Heating (Biomass)` <- df_ph_nox_impacts$`District Heating (Biomass)` * ph_nox_IF_public
       df_ph_nox_impacts$`District Heating (Biomethane)` <- df_ph_nox_impacts$`District Heating (Biomethane)` * ph_nox_IF_public
       df_ph_nox_impacts$`District Heating (Gas)` <- df_ph_nox_impacts$`District Heating (Gas)` * ph_nox_IF_public
       df_ph_nox_impacts$`Gas Boiler` <- df_ph_nox_impacts$`Gas Boiler` * ph_nox_IF_public
       df_ph_nox_impacts$`Gas CHP` <- df_ph_nox_impacts$`Gas CHP` * ph_nox_IF_public
       df_ph_nox_impacts$`District Heating (Hydrogen)` <- df_ph_nox_impacts$`District Heating (Hydrogen)` * ph_nox_IF_public
       df_ph_nox_impacts$`Gas Boiler - H2-NG Blend` <- df_ph_nox_impacts$`Gas Boiler - H2-NG Blend` * ph_nox_IF_public
       df_ph_nox_impacts$`Gas CHP - H2-NG Blend` <- df_ph_nox_impacts$`Gas CHP - H2-NG Blend` * ph_nox_IF_public
       df_ph_nox_impacts$`ASHP + Hydrogen Boiler (Hydrogen)` <- df_ph_nox_impacts$`ASHP + Hydrogen Boiler (Hydrogen)` * ph_nox_IF_public
       df_ph_nox_impacts$`Hydrogen Boiler` <- df_ph_nox_impacts$`Hydrogen Boiler` * ph_nox_IF_public
       df_ph_nox_impacts$`Oil Boiler` <- df_ph_nox_impacts$`Oil Boiler` * ph_nox_IF_public
       df_ph_nox_impacts$`Community Heating` <- df_ph_nox_impacts$`Community Heating` * ph_nox_IF_public
       df_ph_nox_impacts$`Total Emissions` <- rowSums(df_ph_nox_impacts[, 2:17], na.rm = TRUE)
       
       
       
       long_df_ph_nox_impacts <- melt(df_ph_nox_impacts[, 1:17], id.vars = "Year", variable.name = "Source", value.name = "Impacts", na.rm = TRUE)
       
       p <- ggplot(long_df_ph_nox_impacts, aes(Year, Impacts, col = Source)) +
                geom_line() + 
                labs(y = "NOx PWMC Impacts (ng m-3)")
       
       ggplotly(p)
       
     })
     
    
     
     ###################################################################################################################
     
     # Public and commercial PM2.5 Emissions
     
     output$ph_pm25 <- renderPlotly({
       
        req(input_ph_file())
       
       df_ph_pm25_emissions <- input_ph_file()[, 1:17]
       
       df_ph_pm25_emissions$`Biofuel Boiler` <- df_ph_pm25_emissions$`Biofuel Boiler` * ph_pm25_EF_fueloil_boiler
       df_ph_pm25_emissions$`ASHP + Biofuel Boiler (Biofuel)` <- df_ph_pm25_emissions$`ASHP + Biofuel Boiler (Biofuel)` * ph_pm25_EF_fueloil_boiler
       df_ph_pm25_emissions$`Biomass Boiler` <- df_ph_pm25_emissions$`Biomass Boiler` * ph_pm25_EF_biomass_boiler
       df_ph_pm25_emissions$`Biomass CHP` <- df_ph_pm25_emissions$`Biomass CHP` * ph_pm25_EF_biomass_boiler
       df_ph_pm25_emissions$`District Heating (Biomass)` <- df_ph_pm25_emissions$`District Heating (Biomass)` * ph_pm25_EF_biomass_boiler
       df_ph_pm25_emissions$`District Heating (Biomethane)` <- df_ph_pm25_emissions$`District Heating (Biomethane)` * ph_pm25_EF_gas_boiler
       df_ph_pm25_emissions$`District Heating (Gas)` <- df_ph_pm25_emissions$`District Heating (Gas)` * ph_pm25_EF_gas_boiler
       df_ph_pm25_emissions$`Gas Boiler` <- df_ph_pm25_emissions$`Gas Boiler` * ph_pm25_EF_gas_boiler
       df_ph_pm25_emissions$`Gas CHP` <- df_ph_pm25_emissions$`Gas CHP` * ph_pm25_EF_gas_boiler
       df_ph_pm25_emissions$`District Heating (Hydrogen)` <- df_ph_pm25_emissions$`District Heating (Hydrogen)` * ph_pm25_EF_hydrogen_boiler
       df_ph_pm25_emissions$`Gas Boiler - H2-NG Blend` <- df_ph_pm25_emissions$`Gas Boiler - H2-NG Blend` * ph_pm25_EF_hydrogen_natgas_boiler
       df_ph_pm25_emissions$`Gas CHP - H2-NG Blend` <- df_ph_pm25_emissions$`Gas CHP - H2-NG Blend` * ph_pm25_EF_hydrogen_natgas_boiler
       df_ph_pm25_emissions$`ASHP + Hydrogen Boiler (Hydrogen)` <- df_ph_pm25_emissions$`ASHP + Hydrogen Boiler (Hydrogen)` * ph_pm25_EF_hydrogen_boiler
       df_ph_pm25_emissions$`Hydrogen Boiler` <- df_ph_pm25_emissions$`Hydrogen Boiler` * ph_pm25_EF_hydrogen_boiler
       df_ph_pm25_emissions$`Oil Boiler` <- df_ph_pm25_emissions$`Oil Boiler` * ph_pm25_EF_fueloil_boiler
       df_ph_pm25_emissions$`Community Heating` <- df_ph_pm25_emissions$`Community Heating` * ph_pm25_EF_fueloil_boiler
       df_ph_pm25_emissions$`Total Emissions` <- rowSums(df_ph_pm25_emissions[, 2:17], na.rm = TRUE)
       
       
       # PM2.5 PWMC Impacts
       
       df_ph_pm25_impacts <- df_ph_pm25_emissions[, 1:17]
       
       df_ph_pm25_impacts$`Biofuel Boiler` <- df_ph_pm25_impacts$`Biofuel Boiler` * ph_pm25_IF_public
       df_ph_pm25_impacts$`ASHP + Biofuel Boiler (Biofuel)` <- df_ph_pm25_impacts$`ASHP + Biofuel Boiler (Biofuel)` * ph_pm25_IF_public
       df_ph_pm25_impacts$`Biomass Boiler` <- df_ph_pm25_impacts$`Biomass Boiler` * ph_pm25_IF_public
       df_ph_pm25_impacts$`Biomass CHP` <- df_ph_pm25_impacts$`Biomass CHP` * ph_pm25_IF_public
       df_ph_pm25_impacts$`District Heating (Biomass)` <- df_ph_pm25_impacts$`District Heating (Biomass)` * ph_pm25_IF_public
       df_ph_pm25_impacts$`District Heating (Biomethane)` <- df_ph_pm25_impacts$`District Heating (Biomethane)` * ph_pm25_IF_public
       df_ph_pm25_impacts$`District Heating (Gas)` <- df_ph_pm25_impacts$`District Heating (Gas)` * ph_pm25_IF_public
       df_ph_pm25_impacts$`Gas Boiler` <- df_ph_pm25_impacts$`Gas Boiler` * ph_pm25_IF_public
       df_ph_pm25_impacts$`Gas CHP` <- df_ph_pm25_impacts$`Gas CHP` * ph_pm25_IF_public
       df_ph_pm25_impacts$`District Heating (Hydrogen)` <- df_ph_pm25_impacts$`District Heating (Hydrogen)` * ph_pm25_IF_public
       df_ph_pm25_impacts$`Gas Boiler - H2-NG Blend` <- df_ph_pm25_impacts$`Gas Boiler - H2-NG Blend` * ph_pm25_IF_public
       df_ph_pm25_impacts$`Gas CHP - H2-NG Blend` <- df_ph_pm25_impacts$`Gas CHP - H2-NG Blend` * ph_pm25_IF_public
       df_ph_pm25_impacts$`ASHP + Hydrogen Boiler (Hydrogen)` <- df_ph_pm25_impacts$`ASHP + Hydrogen Boiler (Hydrogen)` * ph_pm25_IF_public
       df_ph_pm25_impacts$`Hydrogen Boiler` <- df_ph_pm25_impacts$`Hydrogen Boiler` * ph_pm25_IF_public
       df_ph_pm25_impacts$`Oil Boiler` <- df_ph_pm25_impacts$`Oil Boiler` * ph_pm25_IF_public
       df_ph_pm25_impacts$`Community Heating` <- df_ph_pm25_impacts$`Community Heating` * ph_pm25_IF_public
       df_ph_pm25_impacts$`Total Emissions` <- rowSums(df_ph_pm25_impacts[, 2:17], na.rm = TRUE)
       
       
       
       long_df_ph_pm25_impacts <- melt(df_ph_pm25_impacts[, 1:17], id.vars = "Year", variable.name = "Source", value.name = "Impacts", na.rm = TRUE)
       
       p <- ggplot(long_df_ph_pm25_impacts, aes(Year, Impacts, col = Source)) +
                geom_line() + 
                labs(y = "PM2.5 PWMC Impacts (ng m-3)")
       
       ggplotly(p)
       
       
     })
      
    ####################################################################################################################
      
     # Iron and Steel Combustion Emissions
      
      
      output$ironsteel_co2 <- renderPlotly({
        
        req(ironsteel_data())
        
        ironsteel_co2_emissions <- ironsteel_data()[, c(1,3:6)]
        
        ironsteel_co2_emissions$`Iron and steel - Natural Gas` <- ironsteel_co2_emissions$`Iron and steel - Natural Gas` * ironsteel_co2_EF_gas
        ironsteel_co2_emissions$`Iron and steel - Hydrogen` <- ironsteel_co2_emissions$`Iron and steel - Hydrogen` * ironsteel_co2_EF_hydrogen
        ironsteel_co2_emissions$`Iron and steel - Oil/Petroleum` <- ironsteel_co2_emissions$`Iron and steel - Oil/Petroleum` * ironsteel_co2_EF_fueloil
        ironsteel_co2_emissions$`Iron and steel - Bioenergy/Other` <- ironsteel_co2_emissions$`Iron and steel - Bioenergy/Other` * ironsteel_co2_EF_biomass
        ironsteel_co2_emissions$`Total Emissions` <- rowSums(ironsteel_co2_emissions[ , 2:5], na.rm = TRUE)
        
        long_ironsteel_co2_emissions <- melt(ironsteel_co2_emissions[ , 1:5], id.vars = "Year", variable.name = "Source", value.name = "Emissions", na.rm = TRUE)
        
        p <- ggplot(long_ironsteel_co2_emissions, aes(Year, Emissions, col = Source)) +
                 geom_line() +
                 labs(y = "CO2 Emissions (kt)")
        
        ggplotly(p)
        
        
      })
      
    ####################################################################################################################
      
     output$ironsteel_nox <- renderPlotly({
        
        req(ironsteel_data())
        
        ironsteel_nox_emissions <- ironsteel_data()[, c(1,3:6)]
        
        ironsteel_nox_emissions$`Iron and steel - Natural Gas` <- ironsteel_nox_emissions$`Iron and steel - Natural Gas` * ironsteel_nox_EF_gas
        ironsteel_nox_emissions$`Iron and steel - Hydrogen` <- ironsteel_nox_emissions$`Iron and steel - Hydrogen` * ironsteel_nox_EF_hydrogen
        ironsteel_nox_emissions$`Iron and steel - Oil/Petroleum` <- ironsteel_nox_emissions$`Iron and steel - Oil/Petroleum` * ironsteel_nox_EF_fueloil
        ironsteel_nox_emissions$`Iron and steel - Bioenergy/Other` <- ironsteel_nox_emissions$`Iron and steel - Bioenergy/Other` * ironsteel_nox_EF_biomass
        ironsteel_nox_emissions$`Total Emissions` <- rowSums(ironsteel_nox_emissions[ , 2:5], na.rm = TRUE)
        
        
        ironsteel_nox_impacts <- ironsteel_nox_emissions[, 1:5]
        
        ironsteel_nox_impacts$`Iron and steel - Natural Gas` <- ironsteel_nox_impacts$`Iron and steel - Natural Gas` * ironsteel_nox_IF
        ironsteel_nox_impacts$`Iron and steel - Hydrogen` <- ironsteel_nox_impacts$`Iron and steel - Hydrogen` * ironsteel_nox_IF
        ironsteel_nox_impacts$`Iron and steel - Oil/Petroleum` <- ironsteel_nox_impacts$`Iron and steel - Oil/Petroleum` * ironsteel_nox_IF
        ironsteel_nox_impacts$`Iron and steel - Bioenergy/Other` <- ironsteel_nox_impacts$`Iron and steel - Bioenergy/Other` * ironsteel_nox_IF
        ironsteel_nox_impacts$`Total PWMC Impacts` <- rowSums(ironsteel_nox_impacts[ , 2:5], na.rm = TRUE)
        
        
        long_ironsteel_nox_impacts <- melt(ironsteel_nox_impacts[ , 1:5], id.vars = "Year", variable.name = "Source", value.name = "Impacts", na.rm = TRUE)
        
        p <- ggplot(long_ironsteel_nox_impacts, aes(Year, Impacts, col = Source)) +
                 geom_line() +
                 labs(y = "NOx PWMC Impacts (ng m-3)")
        
        ggplotly(p)
        
      })
      
    ####################################################################################################################
     
     output$ironsteel_pm25 <- renderPlotly({
        
        req(ironsteel_data())
        
        ironsteel_pm25_emissions <- ironsteel_data()[, c(1,3:6)]
        
        ironsteel_pm25_emissions$`Iron and steel - Natural Gas` <- ironsteel_pm25_emissions$`Iron and steel - Natural Gas` * ironsteel_pm25_EF_gas
        ironsteel_pm25_emissions$`Iron and steel - Hydrogen` <- ironsteel_pm25_emissions$`Iron and steel - Hydrogen` * ironsteel_pm25_EF_hydrogen
        ironsteel_pm25_emissions$`Iron and steel - Oil/Petroleum` <- ironsteel_pm25_emissions$`Iron and steel - Oil/Petroleum` * ironsteel_pm25_EF_fueloil
        ironsteel_pm25_emissions$`Iron and steel - Bioenergy/Other` <- ironsteel_pm25_emissions$`Iron and steel - Bioenergy/Other` * ironsteel_pm25_EF_biomass
        ironsteel_pm25_emissions$`Total Emissions` <- rowSums(ironsteel_pm25_emissions[ , 2:5], na.rm = TRUE)

        
        ironsteel_pm25_impacts <- ironsteel_pm25_emissions[, 1:5]
        
        ironsteel_pm25_impacts$`Iron and steel - Natural Gas` <- ironsteel_pm25_impacts$`Iron and steel - Natural Gas` * ironsteel_pm25_IF
        ironsteel_pm25_impacts$`Iron and steel - Hydrogen` <- ironsteel_pm25_impacts$`Iron and steel - Hydrogen` * ironsteel_pm25_IF
        ironsteel_pm25_impacts$`Iron and steel - Oil/Petroleum` <- ironsteel_pm25_impacts$`Iron and steel - Oil/Petroleum` * ironsteel_pm25_IF
        ironsteel_pm25_impacts$`Iron and steel - Bioenergy/Other` <- ironsteel_pm25_impacts$`Iron and steel - Bioenergy/Other` * ironsteel_pm25_IF
        ironsteel_pm25_impacts$`Total PWMC Impacts` <- rowSums(ironsteel_pm25_impacts[ , 2:5], na.rm = TRUE)
        
        
        long_ironsteel_pm25_impacts <- melt(ironsteel_pm25_impacts[ , 1:5], id.vars = "Year", variable.name = "Source", value.name = "Impacts", na.rm = TRUE)
        
        p <- ggplot(long_ironsteel_pm25_impacts, aes(Year, Impacts, col = Source)) +
                 geom_line() +
                 labs(y = "PM2.5 PWMC Impacts (ng m-3)")
        
        ggplotly(p)
        
      })
       
    ####################################################################################################################
       
       # Hydrogen Production Emissions
       
       output$hydrogen_co2 <- renderPlotly({
         
         req(input_hyd_file())
         
         hyd_co2_emissions <- input_hyd_file()[ , 1:4]
         hyd_co2_emissions$`Methane Reformation with CCUS (Blue)` <- hyd_co2_emissions$`Methane Reformation with CCUS (Blue)` * hyd_prod_co2_EF_blue
         hyd_co2_emissions$`Biomass Gasification` <- hyd_co2_emissions$`Biomass Gasification` * hyd_prod_co2_EF_biomass_gasification
         hyd_co2_emissions$`Methane Reformation with CCUS (Grey)` <- hyd_co2_emissions$`Methane Reformation (Grey)` * hyd_prod_co2_EF_grey
         hyd_co2_emissions$`Total Emissions` <- rowSums(hyd_co2_emissions[ , 2:4], na.rm = TRUE)
         
         long_hyd_co2_emissions <- melt(hyd_co2_emissions[ , 1:4], id.vars = "Year", variable.name = "Source", value.name = "Emissions", na.rm = TRUE)
         
         p <- ggplot(long_hyd_co2_emissions, aes(Year, Emissions, col = Source)) +
           geom_line() + 
           labs(y = "CO2 Emissions (kt)")
       
         ggplotly(p)
         
       })
       
    ####################################################################################################################
      
       output$hydrogen_nox <- renderPlotly({
         
         req(input_hyd_file())
         
         hyd_nox_impacts <- input_hyd_file()[ , 1:4]
         hyd_nox_impacts$`Methane Reformation with CCUS (Blue)` <- hyd_nox_impacts$`Methane Reformation with CCUS (Blue)` * hyd_prod_nox_EF_blue * hyd_prod_nox_IF_Gas
         hyd_nox_impacts$`Biomass Gasification` <- hyd_nox_impacts$`Biomass Gasification` * hyd_prod_nox_EF_biomass_gasification * hyd_prod_nox_IF_Gas
         hyd_nox_impacts$`Methane Reformation with CCUS (Grey)` <- hyd_nox_impacts$`Methane Reformation (Grey)` * hyd_prod_nox_EF_grey * hyd_prod_nox_IF_Gas
         hyd_nox_impacts$`Total Emissions` <- rowSums(hyd_nox_impacts[ , 2:4], na.rm = TRUE)
         
         
         long_hyd_nox_impacts <- melt(hyd_nox_impacts[ , 1:4], id.vars = "Year", variable.name = "Source", value.name = "Impacts", na.rm = TRUE)
         
         p <- ggplot(long_hyd_nox_impacts, aes(Year, Impacts, col = Source)) +
           geom_line() + 
           labs(y = "NOx PWMC Impacts (kt)")
         
         ggplotly(p)
       
       })
       
    ####################################################################################################################
      
       output$hydrogen_pm25 <- renderPlotly({
         
         req(input_hyd_file())
         
         hyd_pm25_impacts <- input_hyd_file()[ , 1:4]
         hyd_pm25_impacts$`Methane Reformation with CCUS (Blue)` <- hyd_pm25_impacts$`Methane Reformation with CCUS (Blue)` * hyd_prod_pm25_EF_blue * hyd_prod_pm25_IF_Gas
         hyd_pm25_impacts$`Biomass Gasification` <- hyd_pm25_impacts$`Biomass Gasification` * hyd_prod_pm25_EF_biomass_gasification * hyd_prod_pm25_IF_Gas
         hyd_pm25_impacts$`Methane Reformation with CCUS (Grey)` <- hyd_pm25_impacts$`Methane Reformation (Grey)` * hyd_prod_pm25_EF_grey * hyd_prod_pm25_IF_Gas
         hyd_pm25_impacts$`Total Emissions` <- rowSums(hyd_pm25_impacts[ , 2:4], na.rm = TRUE)
         
         
         long_hyd_pm25_impacts <- melt(hyd_pm25_impacts[ , 1:4], id.vars = "Year", variable.name = "Source", value.name = "Impacts", na.rm = TRUE)
         
         p <- ggplot(long_hyd_pm25_impacts, aes(Year, Impacts, col = Source)) +
           geom_line() + 
           labs(y = "PM2.5 PWMC Impacts (kt)")
         
         ggplotly(p)
       
       })
       
  
        ####################################################################################################################
      
     # Iron and Steel Combustion Emissions
      
      
      output$nfm_co2 <- renderPlotly({
        
        req(nfm_data())
        
        nfm_co2_emissions <- nfm_data()[, c(1,3:6)]
        
        nfm_co2_emissions$`Non-ferrous metals - Natural Gas` <- nfm_co2_emissions$`Non-ferrous metals - Natural Gas` * nfm_co2_EF_gas
        nfm_co2_emissions$`Non-ferrous metals - Hydrogen` <- nfm_co2_emissions$`Non-ferrous metals - Hydrogen` * nfm_co2_EF_hydrogen
        nfm_co2_emissions$`Non-ferrous metals - Oil/Petroleum` <- nfm_co2_emissions$`Non-ferrous metals - Oil/Petroleum` * nfm_co2_EF_fueloil
        nfm_co2_emissions$`Non-ferrous metals - Bioenergy/Other` <- nfm_co2_emissions$`Non-ferrous metals - Bioenergy/Other` * nfm_co2_EF_biomass
        nfm_co2_emissions$`Total Emissions` <- rowSums(nfm_co2_emissions[ , 2:5], na.rm = TRUE)
        
        long_nfm_co2_emissions <- melt(nfm_co2_emissions[ , 1:5], id.vars = "Year", variable.name = "Source", value.name = "Emissions", na.rm = TRUE)
        
        p <- ggplot(long_nfm_co2_emissions, aes(Year, Emissions, col = Source)) +
                 geom_line() +
                 labs(y = "CO2 Emissions (kt)")
        
        ggplotly(p)
        
        
      })
      
    ####################################################################################################################
      
     output$nfm_nox <- renderPlotly({
        
        req(nfm_data())
        
        nfm_nox_emissions <- nfm_data()[, c(1,3:6)]
        
        nfm_nox_emissions$`Non-ferrous metals - Natural Gas` <- nfm_nox_emissions$`Non-ferrous metals - Natural Gas` * nfm_nox_EF_gas
        nfm_nox_emissions$`Non-ferrous metals - Hydrogen` <- nfm_nox_emissions$`Non-ferrous metals - Hydrogen` * nfm_nox_EF_hydrogen
        nfm_nox_emissions$`Non-ferrous metals - Oil/Petroleum` <- nfm_nox_emissions$`Non-ferrous metals - Oil/Petroleum` * nfm_nox_EF_fueloil
        nfm_nox_emissions$`Non-ferrous metals - Bioenergy/Other` <- nfm_nox_emissions$`Non-ferrous metals - Bioenergy/Other` * nfm_nox_EF_biomass
        nfm_nox_emissions$`Total Emissions` <- rowSums(nfm_nox_emissions[ , 2:5], na.rm = TRUE)
        
        
        nfm_nox_impacts <- nfm_nox_emissions[, 1:5]
        
        nfm_nox_impacts$`Non-ferrous metals - Natural Gas` <- nfm_nox_impacts$`Non-ferrous metals - Natural Gas` * nfm_nox_IF
        nfm_nox_impacts$`Non-ferrous metals - Hydrogen` <- nfm_nox_impacts$`Non-ferrous metals - Hydrogen` * nfm_nox_IF
        nfm_nox_impacts$`Non-ferrous metals - Oil/Petroleum` <- nfm_nox_impacts$`Non-ferrous metals - Oil/Petroleum` * nfm_nox_IF
        nfm_nox_impacts$`Non-ferrous metals - Bioenergy/Other` <- nfm_nox_impacts$`Non-ferrous metals - Bioenergy/Other` * nfm_nox_IF
        nfm_nox_impacts$`Total PWMC Impacts` <- rowSums(nfm_nox_impacts[ , 2:5], na.rm = TRUE)
        
        
        long_nfm_nox_impacts <- melt(nfm_nox_impacts[ , 1:5], id.vars = "Year", variable.name = "Source", value.name = "Impacts", na.rm = TRUE)
        
        p <- ggplot(long_nfm_nox_impacts, aes(Year, Impacts, col = Source)) +
                 geom_line() +
                 labs(y = "NOx PWMC Impacts (ng m-3)")
        
        ggplotly(p)
        
      })
      
    ####################################################################################################################
     
     output$nfm_pm25 <- renderPlotly({
        
        req(nfm_data())
        
        nfm_pm25_emissions <- nfm_data()[, c(1,3:6)]
        
        nfm_pm25_emissions$`Non-ferrous metals - Natural Gas` <- nfm_pm25_emissions$`Non-ferrous metals - Natural Gas` * nfm_pm25_EF_gas
        nfm_pm25_emissions$`Non-ferrous metals - Hydrogen` <- nfm_pm25_emissions$`Non-ferrous metals - Hydrogen` * nfm_pm25_EF_hydrogen
        nfm_pm25_emissions$`Non-ferrous metals - Oil/Petroleum` <- nfm_pm25_emissions$`Non-ferrous metals - Oil/Petroleum` * nfm_pm25_EF_fueloil
        nfm_pm25_emissions$`Non-ferrous metals - Bioenergy/Other` <- nfm_pm25_emissions$`Non-ferrous metals - Bioenergy/Other` * nfm_pm25_EF_biomass
        nfm_pm25_emissions$`Total Emissions` <- rowSums(nfm_pm25_emissions[ , 2:5], na.rm = TRUE)
        
        
        nfm_pm25_impacts <- nfm_pm25_emissions[, 1:5]
        
        nfm_pm25_impacts$`Non-ferrous metals - Natural Gas` <- nfm_pm25_impacts$`Non-ferrous metals - Natural Gas` * nfm_pm25_IF
        nfm_pm25_impacts$`Non-ferrous metals - Hydrogen` <- nfm_pm25_impacts$`Non-ferrous metals - Hydrogen` * nfm_pm25_IF
        nfm_pm25_impacts$`Non-ferrous metals - Oil/Petroleum` <- nfm_pm25_impacts$`Non-ferrous metals - Oil/Petroleum` * nfm_pm25_IF
        nfm_pm25_impacts$`Non-ferrous metals - Bioenergy/Other` <- nfm_pm25_impacts$`Non-ferrous metals - Bioenergy/Other` * nfm_pm25_IF
        nfm_pm25_impacts$`Total PWMC Impacts` <- rowSums(nfm_pm25_impacts[ , 2:5], na.rm = TRUE)
        
        
        long_nfm_pm25_impacts <- melt(nfm_pm25_impacts[ , 1:5], id.vars = "Year", variable.name = "Source", value.name = "Impacts", na.rm = TRUE)
        
        p <- ggplot(long_nfm_pm25_impacts, aes(Year, Impacts, col = Source)) +
                 geom_line() +
                 labs(y = "PM2.5 PWMC Impacts (ng m-3)")
        
        ggplotly(p)
        
      })
       
    ####################################################################################################################     
       
       
       
}

shinyApp(ui = ui, server = server)
 
```
