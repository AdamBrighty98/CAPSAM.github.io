---
title: "Homepage"
runtime: shiny
---

## Climate and Air Pollution Synergies Assessment Model (CAPSAM)

Welcome to CAPSAM. A quick and simple model designed to assess how future decarbonisation scenarios will impact air quality.

Fill in the boxes below to more accurately specific your scenario to improve CAPSAM's output and input your scenario data.

```{r, echo=FALSE}


# Loading in data - all impact factors, emission factors, and assumption CSV files
elec_gen_EFs <- read.csv("C:/Users/ab22/Desktop/CAPSAM_CSVs/Elec_EFs_kt_TWh.csv")
dom_heat_EFs <- read.csv("C:/Users/ab22/Desktop/CAPSAM_CSVs/Res_Heat_EFs_kt_TWh.csv")
pub_heat_EFs <- read.csv("C:/Users/ab22/Desktop/CAPSAM_CSVs/Pub_Heat_EFs_kt_TWh.csv")
impact_factors <- read.csv("C:/Users/ab22/Desktop/CAPSAM_CSVs/UK_to_UK_IFs.csv")


# Simplifying names of emission factors - setting them to recognisable names

# Electricity Emission and Impact Factors
# CO2 emission factors
elec_co2_EF_Biomass <- elec_gen_EFs[6,3]
elec_co2_EF_BECCS <- elec_gen_EFs[11,3]
elec_co2_EF_Gas <- elec_gen_EFs[2,3]
elec_co2_EF_GasCCS <- elec_gen_EFs[9,3]
elec_co2_EF_Hydrogen <- elec_gen_EFs[4,3]
elec_co2_EF_Coal <- elec_gen_EFs[1,3]
elec_co2_EF_Waste <- elec_gen_EFs[8,3]
elec_co2_EF_OtherThermal <- elec_gen_EFs[5,3]

# NOx emission factors
elec_nox_EF_Biomass <- elec_gen_EFs[6,4]
elec_nox_EF_BECCS <- elec_gen_EFs[11,4]
elec_nox_EF_Gas <- elec_gen_EFs[2,4]
elec_nox_EF_GasCCS <- elec_gen_EFs[9,4]
elec_nox_EF_Hydrogen <- elec_gen_EFs[4,4]
elec_nox_EF_Coal <- elec_gen_EFs[1,4]
elec_nox_EF_Waste <- elec_gen_EFs[8,4]
elec_nox_EF_OtherThermal <- elec_gen_EFs[5,4]

#PM2.5 emission factors
elec_pm25_EF_Biomass <- elec_gen_EFs[6,5]
elec_pm25_EF_BECCS <- elec_gen_EFs[11,5]
elec_pm25_EF_Gas <- elec_gen_EFs[2,5]
elec_pm25_EF_GasCCS <- elec_gen_EFs[9,5]
elec_pm25_EF_Hydrogen <- elec_gen_EFs[4,5]
elec_pm25_EF_Coal <- elec_gen_EFs[1,5]
elec_pm25_EF_Waste <- elec_gen_EFs[8,5]
elec_pm25_EF_OtherThermal <- elec_gen_EFs[5,5]

#pNOx Electricity Impact Factors
elec_nox_IF_Gas <- impact_factors[1,7]
elec_nox_IF_Landfill <- impact_factors[2,7]
elec_nox_IF_Other <- impact_factors[3,7]

#PM2.5 Electricity Impact Factors
elec_pm25_IF_Gas <- impact_factors[1,6]
elec_pm25_IF_Landfill <- impact_factors[2,6]
elec_pm25_IF_Other <- impact_factors[3,6]

###################################################################################################

# Building Heating Emission and Impact Factors
# Domestic Heat CO2 Emission Factors
dh_co2_EF_SSF_stove <- dom_heat_EFs[1,2]
dh_co2_EF_SSF_boiler <- dom_heat_EFs[2,2]
dh_co2_EF_gasoil_boiler <- dom_heat_EFs[3,2]
dh_co2_EF_gas_boiler <- dom_heat_EFs[4,2]
dh_co2_EF_woodpellet_boiler <- dom_heat_EFs[5,2]
dh_co2_EF_wood_boiler <- dom_heat_EFs[6,2]
dh_co2_EF_wood_fireplace <- dom_heat_EFs[7,2]
dh_co2_EF_hydrogen_boiler <- dom_heat_EFs[8,2]
dh_co2_EF_hydrogen_natgas_boiler <- dom_heat_EFs[9,2]
dh_co2_EF_coal_stove <- dom_heat_EFs[10,2]

# Domestic Heat NOx Emission Factors
dh_nox_EF_SSF_stove <- dom_heat_EFs[1,3]
dh_nox_EF_SSF_boiler <- dom_heat_EFs[2,3]
dh_nox_EF_gasoil_boiler <- dom_heat_EFs[3,3]
dh_nox_EF_gas_boiler <- dom_heat_EFs[4,3]
dh_nox_EF_woodpellet_boiler <- dom_heat_EFs[5,3]
dh_nox_EF_wood_boiler <- dom_heat_EFs[6,3]
dh_nox_EF_wood_fireplace <- dom_heat_EFs[7,3]
dh_nox_EF_hydrogen_boiler <- dom_heat_EFs[8,3]
dh_nox_EF_hydrogen_natgas_boiler <- dom_heat_EFs[9,3]
dh_nox_EF_coal_stove <- dom_heat_EFs[10,3]

# Domestic Heat PM2.5 Emission Factors
dh_pm25_EF_SSF_stove <- dom_heat_EFs[1,4]
dh_pm25_EF_SSF_boiler <- dom_heat_EFs[2,4]
dh_pm25_EF_gasoil_boiler <- dom_heat_EFs[3,4]
dh_pm25_EF_gas_boiler <- dom_heat_EFs[4,4]
dh_pm25_EF_woodpellet_boiler <- dom_heat_EFs[5,4]
dh_pm25_EF_wood_boiler <- dom_heat_EFs[6,4]
dh_pm25_EF_wood_fireplace <- dom_heat_EFs[7,4]
dh_pm25_EF_hydrogen_boiler <- dom_heat_EFs[8,4]
dh_pm25_EF_hydrogen_natgas_boiler <- dom_heat_EFs[9,4]
dh_pm25_EF_coal_stove <- dom_heat_EFs[10,4]

#pNOx Domestic Heat Impact Factors
dh_nox_IF_coal <- impact_factors[7,7]
dh_nox_IF_gas <- impact_factors[8,7]
dh_nox_IF_oil <- impact_factors[9,7]
dh_nox_IF_wood <- impact_factors[10,7]

#PM2.5 Domestic Heat Impact Factors
dh_pm25_IF_coal <- impact_factors[7,6]
dh_pm25_IF_gas <- impact_factors[8,6]
dh_pm25_IF_oil <- impact_factors[9,6]
dh_pm25_IF_wood <- impact_factors[10,6]

#################################################################################################

# Building Heating Emission and Impact Factors
# Public and Commercial Heat CO2 Emission Factors
ph_co2_EF_coal_boiler <- pub_heat_EFs[1,2]
ph_co2_EF_fueloil_boiler <- pub_heat_EFs[2,2]
ph_co2_EF_gas_boiler <- pub_heat_EFs[3,2]
ph_co2_EF_biomass_boiler <- pub_heat_EFs[4,2]
ph_co2_EF_hydrogen_natgas_boiler <- pub_heat_EFs[5,2]
ph_co2_EF_hydrogen_boiler <- pub_heat_EFs[6,2]

# Public and Commercial Heat NOx Emission Factors
ph_nox_EF_coal_boiler <- pub_heat_EFs[1,3]
ph_nox_EF_fueloil_boiler <- pub_heat_EFs[2,3]
ph_nox_EF_gas_boiler <- pub_heat_EFs[3,3]
ph_nox_EF_biomass_boiler <- pub_heat_EFs[4,3]
ph_nox_EF_hydrogen_natgas_boiler <- pub_heat_EFs[5,3]
ph_nox_EF_hydrogen_boiler <- pub_heat_EFs[6,3]

# Public and Commercial Heat PM2.5 Emission Factors
ph_pm25_EF_coal_boiler <- pub_heat_EFs[1,4]
ph_pm25_EF_fueloil_boiler <- pub_heat_EFs[2,4]
ph_pm25_EF_gas_boiler <- pub_heat_EFs[3,4]
ph_pm25_EF_biomass_boiler <- pub_heat_EFs[4,4]
ph_pm25_EF_hydrogen_natgas_boiler <- pub_heat_EFs[5,4]
ph_pm25_EF_hydrogen_boiler <- pub_heat_EFs[6,4]

#pNOx Public and Commercial Heat Impact Factors
ph_nox_IF_public <- impact_factors[11,7]

#PM2.5 Public and Commercial Heat Impact Factors
ph_pm25_IF_public <- impact_factors[11,6]

#################################################################################################

# Variables for initial selection

sectors <- c("Electricity Generation", "Building Heating", "Industrial Combustion")
data_levels_Heating <- c("N/A", "Technologic-specific energy demand (e.g., electricity demand from heat pumps for building heating)", "Number of technologies installed (e.g., number of heat pumps installed)", "Overall sectoral energy demand (e.g., hydrogen demand for building heating)")
data_levels_Industrial <- c("N/A", "Process-specific energy demand (e.g., electricity demand for Iron & Steel)", "Overall sectoral energy demand (e.g., hydrogen demand for industrial combustion)" )
countries <- c("UK", "England", "Wales", "Scotland", "Northern Ireland")
impact_factor_choice <- c("UK", "England", "Wales", "Scotland", "Northern Ireland")
units <- c("TWh", "GWh", "PJ", "TJ", "GJ")
lifecycle_data <- c("Electricity Generation", "Hydrogen Production", "None of the above")

# Initial Selection Criteria

library(shiny)
library(shinydashboard)
library(shinydashboardPlus)
library(ggplot2)
library(plotly)
library(tidyverse)
library(dplyr)
library(reshape2)

ui <- dashboardPage(skin = "purple",
  
  dashboardHeader(title = "CAPSAM"),
  
  dashboardSidebar(
    
    
  
  sidebarMenu(
    menuItem("Scenario Questions and Upload", tabName = "upload", icon = icon("upload")),
    menuItem("About CAPSAM", tabName = "about", icon = icon("about"))
    
  )
  ),
  
  dashboardBody(
    
    
    
    
    
    
    fluidRow(
      
      tabBox(title = "Data Input",
             
             tabPanel("Scenario Questions",
         # Selecting which sectors are present in each scenario
         checkboxGroupInput("sectors", "Select all relevant sectors: ", choices = sectors),    
         # Deciding on basic levels of information for Building Heating
         selectInput("dataLevels", "Select the level of detail involved in the building heating scenario. If building heating is not included, select N/A.", choices = data_levels_Heating),    
         # Deciding on basic levels of information for Industrial Combustion
         selectInput("dataLevels", "Select the level of detail involved in the industrial combustion scenario. If industrial combustion is not included, select N/A.", choices = data_levels_Industrial),  
      
  
  ),
  
            tabPanel("Set Parameters and Import csv",
           
           # Selecting lifecycle aspects
           checkboxGroupInput("lifecycle", "What lifecycle information does your scenario contain? Select all relevant boxes", choices = lifecycle_data),
  
           # Selecting base and end years
          numericInput("baseYear", "What is your base (initial) year of your scenario?", value = 0),
          numericInput("endYear", "What is the end year of your scenario?", value = 0),  
           
         # Selecting units found in each scenario
          selectInput("units", "Please Select the Units used within your scenario: ", choices = units),
  
          # Inputting elec gen CSV input
          fileInput("elec_file", "Select your electricity generation file: "),
         
         # Inputting domestic heat csv input
         fileInput("dh_file", "Select your domestic combustion file:"),
         
         # Inputting public and commercial heat csv input
         fileInput("ph_file", "Select your public and commercial combustion file: "),
           
          actionButton("simulate", "Simulate")
    
  )),
  
          tabBox(title = "CSV Download",
           tabPanel("Download", "Click here to download csv templates for your scenario")),
  
  
  
  ),
  

    

  
  fluidRow(
  
  tabBox(title = "Results", width = 12,
    
    tabPanel("CO2 Emissions - Electricity", h1(textOutput("elec_caption_co2")), plotOutput("elec_co2"), downloadButton("download_elec_co2", "Download")),
    tabPanel("NOx PWMC Impact - Electricity", h2(textOutput("elec_caption_nox")), plotOutput("elec_nox")),
    tabPanel("PM2.5 PWMC Impact - Electricity", h3(textOutput("elec_caption_pm2.5")), plotOutput("elec_pm25")),
    tabPanel("CO2 Emissions - Domestic Heating", h1(textOutput("dh_caption_co2")), plotOutput("dh_co2")),
    tabPanel("NOx PWMC Impact - Domestic Heating", h2(textOutput("dh_caption_nox")), plotOutput("dh_nox")),
    tabPanel("PM2.5 PWMC Impact - Domestic Heating", h3(textOutput("dh_caption_pm2.5")), plotOutput("dh_pm25")),
    tabPanel("CO2 Emissions - Public Heating", h1(textOutput("ph_caption_co2")), plotOutput("ph_co2")),
    tabPanel("NOx PWMC Impact - Public Heating", h2(textOutput("ph_caption_nox")), plotOutput("ph_nox")),
    tabPanel("PM2.5 PWMC Impact - Public Heating", h3(textOutput("ph_caption_pm2.5")), plotOutput("ph_pm25"))
  
  )),
        
  
  
  
    
  ),
  
  
  
)

# Server-side logic

server <- function(input, output, session) {
  
   input_elec_file <- reactive({
      if(is.null(input$elec_file)) {
        return("")
      }
    
      # reading input file now on server side
      read.csv(file = input$elec_file$datapath, fileEncoding='UTF-8-BOM', header = FALSE)
    
    })
   
    input_dh_file <- reactive({
      if(is.null(input$dh_file)) {
        return("")
      }
    
      # reading input file now on server side
      read.csv(file = input$dh_file$datapath, fileEncoding='UTF-8-BOM', header = FALSE)
    
    })
    
     input_ph_file <- reactive({
      if(is.null(input$ph_file)) {
        return("")
      }
    
      # reading input file now on server side
      read.csv(file = input$ph_file$datapath, fileEncoding='UTF-8-BOM', header = FALSE)
    
    })
   
###########################################################################################################################################
     
     # elec_gen_data <- reactive({
     #   
     #   elec_data <- input_elec_file()
     #   
     #  # Rotating csv from horizontal to vertical - easier for multiplication
     #  colnames = as.character(elec_data[ , 1])
     #  elec_data = data.frame(t(elec_data[ , -1]))
     #  colnames(elec_data) = colnames
     #  # Adding Sum column at end of elec data - for PWMC Impacts per Unit Energy
     #  elec_data$Sum <- rowSums(elec_data[, 2:16], na.rm = TRUE)
     #  # Removing decimals from year (common syntax) - set to zero decimals in elec_data will roll over!
     #  elec_data$Year <- format(elec_data$Year, 0)
     #   
     # })
     
     
     
     # Electricity Generation
     
  # CO2 Emissions - line plot from elec gen (flipped to long)
   
     output$elec_co2 <- renderPlot({
        
      req(input_elec_file())
       
       elec_data <- input_elec_file()
       
      # Rotating csv from horizontal to vertical - easier for multiplication
      colnames = as.character(elec_data[ , 1])
      elec_data = data.frame(t(elec_data[ , -1]))
      colnames(elec_data) = colnames
      # Adding Sum column at end of elec data - for PWMC Impacts per Unit Energy
      elec_data$Sum <- rowSums(elec_data[, 2:16], na.rm = TRUE)
      # Removing decimals from year (common syntax) - set to zero decimals in elec_data will roll over!
      elec_data$Year <- format(elec_data$Year, 0)
       
       
      
      
       df_elec_co2_emissions <- elec_data[, 1:9]
       
       df_elec_co2_emissions$Biomass <- df_elec_co2_emissions$Biomass * elec_co2_EF_Biomass
       df_elec_co2_emissions$BECCS <- df_elec_co2_emissions$BECCS * elec_co2_EF_BECCS
       df_elec_co2_emissions$Gas <- df_elec_co2_emissions$Gas * elec_co2_EF_Gas
       df_elec_co2_emissions$`Gas CCS` <- df_elec_co2_emissions$`Gas CCS` * elec_co2_EF_GasCCS
       df_elec_co2_emissions$Hydrogen <- df_elec_co2_emissions$Hydrogen * elec_co2_EF_Hydrogen
       df_elec_co2_emissions$Coal <- df_elec_co2_emissions$Coal * elec_co2_EF_Coal
       df_elec_co2_emissions$Waste <- df_elec_co2_emissions$Waste * elec_co2_EF_Waste
       df_elec_co2_emissions$`Other thermal` <- df_elec_co2_emissions$`Other thermal` * elec_co2_EF_OtherThermal
       df_elec_co2_emissions$`Total Emissions` <- rowSums(df_elec_co2_emissions[,2:9], na.rm = TRUE)
       
       
       long_df_elec_co2_emissions <- melt(df_elec_co2_emissions[, 1:9], id.vars = "Year", variable.name = "Source", value.name = "Emissions", na.rm = TRUE)

   
        ggplot(long_df_elec_co2_emissions,
               aes(Year, Emissions, group = Source, col = Source)) +
        geom_line() + 
        labs(y = "CO2 Emissions (kt)")
        
        
     })
     
     #########################################################################################################
     
     output$download_elec_co2 <- downloadHandler({
       
       filename = function() {
         paste("elec_co2_data-", Sys.Date(), ".csv", sep = "")
       }
       
       content = function(file) {
         
         write.csv(elec_co2$df_elec_co2_emissions(), file)
         
       }
     })
     
     # NOx PWMC Impacts (currently not weighted per unit energy)
     
     
      output$elec_nox <- renderPlot({
        
      req(input_elec_file())
       
       elec_data <- input_elec_file()
       
      # Rotating csv from horizontal to vertical - easier for multiplication
      colnames = as.character(elec_data[ , 1])
      elec_data = data.frame(t(elec_data[ , -1]))
      colnames(elec_data) = colnames
      # Adding Sum column at end of elec data - for PWMC Impacts per Unit Energy
      elec_data$Sum <- rowSums(elec_data[, 2:16], na.rm = TRUE)
      # Removing decimals from year (common syntax) - set to zero decimals in elec_data will roll over!
      elec_data$Year <- format(elec_data$Year, 0)
      
      
       
       
       df_elec_nox_emissions <- elec_data[, 1:9]
       
       df_elec_nox_emissions$Biomass <- df_elec_nox_emissions$Biomass * elec_nox_EF_Biomass
       df_elec_nox_emissions$BECCS <- df_elec_nox_emissions$BECCS * elec_nox_EF_BECCS
       df_elec_nox_emissions$Gas <- df_elec_nox_emissions$Gas * elec_nox_EF_Gas
       df_elec_nox_emissions$`Gas CCS` <- df_elec_nox_emissions$`Gas CCS` * elec_nox_EF_GasCCS
       df_elec_nox_emissions$Hydrogen <- df_elec_nox_emissions$Hydrogen * elec_nox_EF_Hydrogen
       df_elec_nox_emissions$Coal <- df_elec_nox_emissions$Coal * elec_nox_EF_Coal
       df_elec_nox_emissions$Waste <- df_elec_nox_emissions$Waste * elec_nox_EF_Waste
       df_elec_nox_emissions$`Other thermal` <- df_elec_nox_emissions$`Other thermal` * elec_nox_EF_OtherThermal
       df_elec_nox_emissions$`Total Emissions` <- rowSums(df_elec_nox_emissions[, 2:9], na.rm = TRUE)
       
       # Producing PWMC Impacts using UK-to-UK impact factors 
       # Copying - may not need to include new Sums table as could be carried over?
       df_elec_nox_impacts <- df_elec_nox_emissions[,1:9]

       # pNOx Impacts from electricity generation
       df_elec_nox_impacts$Biomass <- df_elec_nox_impacts$Biomass * elec_nox_IF_Other
       df_elec_nox_impacts$BECCS <- df_elec_nox_impacts$BECCS * elec_nox_IF_Other
       df_elec_nox_impacts$Gas <- df_elec_nox_impacts$Gas * elec_nox_IF_Gas
       df_elec_nox_impacts$`Gas CCS` <- df_elec_nox_impacts$`Gas CCS` * elec_nox_IF_Gas
       df_elec_nox_impacts$Hydrogen <- df_elec_nox_impacts$Hydrogen * elec_nox_IF_Gas
       df_elec_nox_impacts$Coal <- df_elec_nox_impacts$Coal * elec_nox_IF_Other
       df_elec_nox_impacts$Waste <- df_elec_nox_impacts$Waste * elec_nox_IF_Other
       df_elec_nox_impacts$`Other thermal` <- df_elec_nox_impacts$`Other thermal` * elec_nox_IF_Other
       df_elec_nox_impacts$`Total Impact` <- rowSums(df_elec_nox_impacts[, 2:9], na.rm = TRUE) 
       
       
       long_df_elec_nox_impacts <- melt(df_elec_nox_impacts[, 1:9], id.vars = "Year", variable.name = "Source", value.name = "PWMC", na.rm = TRUE)

   
        ggplot(long_df_elec_nox_impacts, aes(Year, PWMC, group = Source, col = Source)) +
        geom_line() + 
        labs(y = "NOx PWMC Impact (ng m-3)")
        
        
     })   
     
      #########################################################################################################
     
     # PM2.5 PWMC Impacts (currently not weighted per unit energy)
     
     output$elec_pm25 <- renderPlot({
        
      req(input_elec_file())
       
       elec_data <- input_elec_file()
       
      # Rotating csv from horizontal to vertical - easier for multiplication
      colnames = as.character(elec_data[ , 1])
      elec_data = data.frame(t(elec_data[ , -1]))
      colnames(elec_data) = colnames
      # Adding Sum column at end of elec data - for PWMC Impacts per Unit Energy
      elec_data$Sum <- rowSums(elec_data[, 2:16], na.rm = TRUE)
      # Removing decimals from year (common syntax) - set to zero decimals in elec_data will roll over!
      elec_data$Year <- format(elec_data$Year, 0)
      
      
       
       
       df_elec_pm25_emissions <- elec_data[, 1:9]
       
       
       df_elec_pm25_emissions$Biomass <- df_elec_pm25_emissions$Biomass * elec_pm25_EF_Biomass
       df_elec_pm25_emissions$BECCS <- df_elec_pm25_emissions$BECCS * elec_pm25_EF_BECCS
       df_elec_pm25_emissions$Gas <- df_elec_pm25_emissions$Gas * elec_pm25_EF_Gas
       df_elec_pm25_emissions$`Gas CCS` <- df_elec_pm25_emissions$`Gas CCS` * elec_pm25_EF_GasCCS
       df_elec_pm25_emissions$Hydrogen <- df_elec_pm25_emissions$Hydrogen * elec_pm25_EF_Hydrogen
       df_elec_pm25_emissions$Coal <- df_elec_pm25_emissions$Coal * elec_pm25_EF_Coal
       df_elec_pm25_emissions$Waste <- df_elec_pm25_emissions$Waste * elec_pm25_EF_Waste
       df_elec_pm25_emissions$`Other thermal` <- df_elec_pm25_emissions$`Other thermal` * elec_pm25_EF_OtherThermal
       df_elec_pm25_emissions$`Total Emissions` <- rowSums(df_elec_pm25_emissions[, 2:9], na.rm = TRUE)
       
       # Producing PWMC Impacts using UK-to-UK impact factors 
       df_elec_pm25_impacts <- df_elec_pm25_emissions[,1:9]

       # pNOx Impacts from electricity generation
       df_elec_pm25_impacts$Biomass <- df_elec_pm25_impacts$Biomass * elec_pm25_IF_Other
       df_elec_pm25_impacts$BECCS <- df_elec_pm25_impacts$BECCS * elec_pm25_IF_Other
       df_elec_pm25_impacts$Gas <- df_elec_pm25_impacts$Gas * elec_pm25_IF_Gas
       df_elec_pm25_impacts$`Gas CCS` <- df_elec_pm25_impacts$`Gas CCS` * elec_pm25_IF_Gas
       df_elec_pm25_impacts$Hydrogen <- df_elec_pm25_impacts$Hydrogen * elec_pm25_IF_Gas
       df_elec_pm25_impacts$Coal <- df_elec_pm25_impacts$Coal * elec_pm25_IF_Other
       df_elec_pm25_impacts$Waste <- df_elec_pm25_impacts$Waste * elec_pm25_IF_Other
       df_elec_pm25_impacts$`Other thermal` <- df_elec_pm25_impacts$`Other thermal` * elec_pm25_IF_Other
       df_elec_pm25_impacts$`Total Impact` <- rowSums(df_elec_pm25_impacts[, 2:9], na.rm = TRUE)
       
       
       long_df_elec_pm25_impacts <- melt(df_elec_pm25_impacts[, 1:9], id.vars = "Year", variable.name = "Source", value.name = "PWMC", na.rm = TRUE)

   
        ggplot(long_df_elec_pm25_impacts, aes(Year, PWMC, group = Source, col = Source)) +
        geom_line() + 
        labs(y = "PM2.5 PWMC Impact (ng m-3)")
        
        
     })   
     
     ###################################################################################################################################################
     
     # Domestic Heating
     
     # Domestic Heating CO2 Emissions
     
     output$dh_co2 <- renderPlot({
       
       req(input_dh_file())
       
       dh_data <- input_dh_file()
       
       colnames = as.character(dh_data[ , 1])
       dh_data = data.frame(t(dh_data[ , -1]))
       colnames(dh_data) = colnames
       dh_data$Sum <- rowSums(dh_data[ , 2:28], na.rm = TRUE)
       dh_data$Year <- format(dh_data$Year, 0)
       
       df_dh_co2_emissions <- dh_data[, 1:17]
       
       df_dh_co2_emissions$`Biofuel Boiler` <- df_dh_co2_emissions$`Biofuel Boiler` * dh_co2_EF_gasoil_boiler
       df_dh_co2_emissions$`ASHP + Biofuel Boiler (Biofuel)` <- df_dh_co2_emissions$`ASHP + Biofuel Boiler (Biofuel)` * dh_co2_EF_gasoil_boiler
       df_dh_co2_emissions$`Biomass Boiler` <- df_dh_co2_emissions$`Biomass Boiler` * dh_co2_EF_woodpellet_boiler
       df_dh_co2_emissions$`Biomass CHP` <- df_dh_co2_emissions$`Biomass CHP` * ph_co2_EF_biomass_boiler
       df_dh_co2_emissions$`District Heating (Biomass)` <- df_dh_co2_emissions$`District Heating (Biomass)` * ph_co2_EF_biomass_boiler
       df_dh_co2_emissions$`District Heating (Biomethane)` <- df_dh_co2_emissions$`District Heating (Biomethane)` * ph_co2_EF_gas_boiler
       df_dh_co2_emissions$`District Heating (Gas)` <- df_dh_co2_emissions$`District Heating (Gas)` * ph_co2_EF_gas_boiler
       df_dh_co2_emissions$`Gas Boiler` <- df_dh_co2_emissions$`Gas Boiler` * dh_co2_EF_gas_boiler
       df_dh_co2_emissions$`Gas CHP` <- df_dh_co2_emissions$`Gas CHP` * ph_co2_EF_gas_boiler
       df_dh_co2_emissions$`District Heating (Hydrogen)` <- df_dh_co2_emissions$`District Heating (Hydrogen)` * ph_co2_EF_hydrogen_boiler
       df_dh_co2_emissions$`Gas Boiler - H2-NG Blend` <- df_dh_co2_emissions$`Gas Boiler - H2-NG Blend` * dh_co2_EF_hydrogen_natgas_boiler
       df_dh_co2_emissions$`Gas CHP - H2-NG Blend` <- df_dh_co2_emissions$`Gas CHP - H2-NG Blend` * ph_co2_EF_hydrogen_natgas_boiler
       df_dh_co2_emissions$`ASHP + Hydrogen Boiler (Hydrogen)` <- df_dh_co2_emissions$`ASHP + Hydrogen Boiler (Hydrogen)` * dh_co2_EF_hydrogen_boiler
       df_dh_co2_emissions$`Hydrogen Boiler` <- df_dh_co2_emissions$`Hydrogen Boiler` * dh_co2_EF_hydrogen_boiler
       df_dh_co2_emissions$`Oil Boiler` <- df_dh_co2_emissions$`Oil Boiler` * dh_co2_EF_gasoil_boiler
       df_dh_co2_emissions$`Community Heating` <- df_dh_co2_emissions$`Community Heating` * ph_co2_EF_fueloil_boiler
       df_dh_co2_emissions$`Total Emissions` <- rowSums(df_dh_co2_emissions[, 2:17], na.rm = TRUE)
       
       
       long_df_dh_co2_emissions <- melt(df_dh_co2_emissions[, 1:17], id.vars = "Year", variable.name = "Source", value.name = "Emissions", na.rm = TRUE)
       
       ggplot(long_df_dh_co2_emissions, aes(Year, Emissions, group = Source, col = Source)) +
                geom_line() + 
                labs(y = "CO2 Emissions (kt)")
       
       
       
     })
 
     
     ###############################################################################################################     
     
     # Domestic Heating NOx Emissions
     
     output$dh_nox <- renderPlot({
       
       req(input_dh_file())
       
       dh_data <- input_dh_file()
       
       colnames = as.character(dh_data[ , 1])
       dh_data = data.frame(t(dh_data[ , -1]))
       colnames(dh_data) = colnames
       dh_data$Sum <- rowSums(dh_data[ , 2:28], na.rm = TRUE)
       dh_data$Year <- format(dh_data$Year, 0)
       
       df_dh_nox_emissions <- dh_data[, 1:17]
       
       df_dh_nox_emissions$`Biofuel Boiler` <- df_dh_nox_emissions$`Biofuel Boiler` * dh_nox_EF_gasoil_boiler
       df_dh_nox_emissions$`ASHP + Biofuel Boiler (Biofuel)` <- df_dh_nox_emissions$`ASHP + Biofuel Boiler (Biofuel)` * dh_nox_EF_gasoil_boiler
       df_dh_nox_emissions$`Biomass Boiler` <- df_dh_nox_emissions$`Biomass Boiler` * dh_nox_EF_woodpellet_boiler
       df_dh_nox_emissions$`Biomass CHP` <- df_dh_nox_emissions$`Biomass CHP` * ph_nox_EF_biomass_boiler
       df_dh_nox_emissions$`District Heating (Biomass)` <- df_dh_nox_emissions$`District Heating (Biomass)` * ph_nox_EF_biomass_boiler
       df_dh_nox_emissions$`District Heating (Biomethane)` <- df_dh_nox_emissions$`District Heating (Biomethane)` * ph_nox_EF_gas_boiler
       df_dh_nox_emissions$`District Heating (Gas)` <- df_dh_nox_emissions$`District Heating (Gas)` * ph_nox_EF_gas_boiler
       df_dh_nox_emissions$`Gas Boiler` <- df_dh_nox_emissions$`Gas Boiler` * dh_nox_EF_gas_boiler
       df_dh_nox_emissions$`Gas CHP` <- df_dh_nox_emissions$`Gas CHP` * ph_nox_EF_gas_boiler
       df_dh_nox_emissions$`District Heating (Hydrogen)` <- df_dh_nox_emissions$`District Heating (Hydrogen)` * ph_nox_EF_hydrogen_boiler
       df_dh_nox_emissions$`Gas Boiler - H2-NG Blend` <- df_dh_nox_emissions$`Gas Boiler - H2-NG Blend` * dh_nox_EF_hydrogen_natgas_boiler
       df_dh_nox_emissions$`Gas CHP - H2-NG Blend` <- df_dh_nox_emissions$`Gas CHP - H2-NG Blend` * ph_nox_EF_hydrogen_natgas_boiler
       df_dh_nox_emissions$`ASHP + Hydrogen Boiler (Hydrogen)` <- df_dh_nox_emissions$`ASHP + Hydrogen Boiler (Hydrogen)` * dh_nox_EF_hydrogen_boiler
       df_dh_nox_emissions$`Hydrogen Boiler` <- df_dh_nox_emissions$`Hydrogen Boiler` * dh_nox_EF_hydrogen_boiler
       df_dh_nox_emissions$`Oil Boiler` <- df_dh_nox_emissions$`Oil Boiler` * dh_nox_EF_gasoil_boiler
       df_dh_nox_emissions$`Community Heating` <- df_dh_nox_emissions$`Community Heating` * ph_nox_EF_fueloil_boiler
       df_dh_nox_emissions$`Total Emissions` <- rowSums(df_dh_nox_emissions[, 2:17], na.rm = TRUE)
       
       
       # pNOx PWMC Impacts
       
       df_dh_nox_impacts <- df_dh_nox_emissions[, 1:17]
       
       df_dh_nox_impacts$`Biofuel Boiler` <- df_dh_nox_impacts$`Biofuel Boiler` * dh_nox_IF_oil
       df_dh_nox_impacts$`ASHP + Biofuel Boiler (Biofuel)` <- df_dh_nox_impacts$`ASHP + Biofuel Boiler (Biofuel)` * dh_nox_IF_oil
       df_dh_nox_impacts$`Biomass Boiler` <- df_dh_nox_impacts$`Biomass Boiler` * dh_nox_IF_wood
       df_dh_nox_impacts$`Biomass CHP` <- df_dh_nox_impacts$`Biomass CHP` * ph_nox_IF_public
       df_dh_nox_impacts$`District Heating (Biomass)` <- df_dh_nox_impacts$`District Heating (Biomass)` * ph_nox_IF_public
       df_dh_nox_impacts$`District Heating (Biomethane)` <- df_dh_nox_impacts$`District Heating (Biomethane)` * ph_nox_IF_public
       df_dh_nox_impacts$`District Heating (Gas)` <- df_dh_nox_impacts$`District Heating (Gas)` * ph_nox_IF_public
       df_dh_nox_impacts$`Gas Boiler` <- df_dh_nox_impacts$`Gas Boiler` * dh_nox_IF_gas
       df_dh_nox_impacts$`Gas CHP` <- df_dh_nox_impacts$`Gas CHP` * ph_nox_IF_public
       df_dh_nox_impacts$`District Heating (Hydrogen)` <- df_dh_nox_impacts$`District Heating (Hydrogen)` * ph_nox_IF_public
       df_dh_nox_impacts$`Gas Boiler - H2-NG Blend` <- df_dh_nox_impacts$`Gas Boiler - H2-NG Blend` * dh_nox_IF_gas
       df_dh_nox_impacts$`Gas CHP - H2-NG Blend` <- df_dh_nox_impacts$`Gas CHP - H2-NG Blend` * ph_nox_IF_public
       df_dh_nox_impacts$`ASHP + Hydrogen Boiler (Hydrogen)` <- df_dh_nox_impacts$`ASHP + Hydrogen Boiler (Hydrogen)` * dh_nox_IF_gas
       df_dh_nox_impacts$`Hydrogen Boiler` <- df_dh_nox_impacts$`Hydrogen Boiler` * dh_nox_IF_gas
       df_dh_nox_impacts$`Oil Boiler` <- df_dh_nox_impacts$`Oil Boiler` * dh_nox_IF_oil
       df_dh_nox_impacts$`Community Heating` <- df_dh_nox_impacts$`Community Heating` * ph_nox_IF_public
       df_dh_nox_impacts$`Total Emissions` <- rowSums(df_dh_nox_impacts[, 2:17], na.rm = TRUE)
       
       
       
       long_df_dh_nox_impacts <- melt(df_dh_nox_impacts[, 1:17], id.vars = "Year", variable.name = "Source", value.name = "Impacts", na.rm = TRUE)
       
       ggplot(long_df_dh_nox_impacts, aes(Year, Impacts, group = Source, col = Source)) +
                geom_line() + 
                labs(y = "NOx PWMC Impacts (ng m-3)")
       
       
       
     })
     
    
     
     ###################################################################################################################
     
     # Domestic PM2.5 Emissions
     
     output$dh_pm25 <- renderPlot({
       
       req(input_dh_file())
       
       dh_data <- input_dh_file()
       
       colnames = as.character(dh_data[ , 1])
       dh_data = data.frame(t(dh_data[ , -1]))
       colnames(dh_data) = colnames
       dh_data$Sum <- rowSums(dh_data[ , 2:28], na.rm = TRUE)
       dh_data$Year <- format(dh_data$Year, 0)
       
       df_dh_pm25_emissions <- dh_data[, 1:17]
       
       df_dh_pm25_emissions$`Biofuel Boiler` <- df_dh_pm25_emissions$`Biofuel Boiler` * dh_pm25_EF_gasoil_boiler
       df_dh_pm25_emissions$`ASHP + Biofuel Boiler (Biofuel)` <- df_dh_pm25_emissions$`ASHP + Biofuel Boiler (Biofuel)` * dh_pm25_EF_gasoil_boiler
       df_dh_pm25_emissions$`Biomass Boiler` <- df_dh_pm25_emissions$`Biomass Boiler` * dh_pm25_EF_woodpellet_boiler
       df_dh_pm25_emissions$`Biomass CHP` <- df_dh_pm25_emissions$`Biomass CHP` * ph_pm25_EF_biomass_boiler
       df_dh_pm25_emissions$`District Heating (Biomass)` <- df_dh_pm25_emissions$`District Heating (Biomass)` * ph_pm25_EF_biomass_boiler
       df_dh_pm25_emissions$`District Heating (Biomethane)` <- df_dh_pm25_emissions$`District Heating (Biomethane)` * ph_pm25_EF_gas_boiler
       df_dh_pm25_emissions$`District Heating (Gas)` <- df_dh_pm25_emissions$`District Heating (Gas)` * ph_pm25_EF_gas_boiler
       df_dh_pm25_emissions$`Gas Boiler` <- df_dh_pm25_emissions$`Gas Boiler` * dh_pm25_EF_gas_boiler
       df_dh_pm25_emissions$`Gas CHP` <- df_dh_pm25_emissions$`Gas CHP` * ph_pm25_EF_gas_boiler
       df_dh_pm25_emissions$`District Heating (Hydrogen)` <- df_dh_pm25_emissions$`District Heating (Hydrogen)` * ph_pm25_EF_hydrogen_boiler
       df_dh_pm25_emissions$`Gas Boiler - H2-NG Blend` <- df_dh_pm25_emissions$`Gas Boiler - H2-NG Blend` * dh_pm25_EF_hydrogen_natgas_boiler
       df_dh_pm25_emissions$`Gas CHP - H2-NG Blend` <- df_dh_pm25_emissions$`Gas CHP - H2-NG Blend` * ph_pm25_EF_hydrogen_natgas_boiler
       df_dh_pm25_emissions$`ASHP + Hydrogen Boiler (Hydrogen)` <- df_dh_pm25_emissions$`ASHP + Hydrogen Boiler (Hydrogen)` * dh_pm25_EF_hydrogen_boiler
       df_dh_pm25_emissions$`Hydrogen Boiler` <- df_dh_pm25_emissions$`Hydrogen Boiler` * dh_pm25_EF_hydrogen_boiler
       df_dh_pm25_emissions$`Oil Boiler` <- df_dh_pm25_emissions$`Oil Boiler` * dh_pm25_EF_gasoil_boiler
       df_dh_pm25_emissions$`Community Heating` <- df_dh_pm25_emissions$`Community Heating` * ph_pm25_EF_fueloil_boiler
       df_dh_pm25_emissions$`Total Emissions` <- rowSums(df_dh_pm25_emissions[, 2:17], na.rm = TRUE)
       
       
       # pNOx PWMC Impacts
       
       df_dh_pm25_impacts <- df_dh_pm25_emissions[, 1:17]
       
       df_dh_pm25_impacts$`Biofuel Boiler` <- df_dh_pm25_impacts$`Biofuel Boiler` * dh_nox_IF_oil
       df_dh_pm25_impacts$`ASHP + Biofuel Boiler (Biofuel)` <- df_dh_pm25_impacts$`ASHP + Biofuel Boiler (Biofuel)` * dh_nox_IF_oil
       df_dh_pm25_impacts$`Biomass Boiler` <- df_dh_pm25_impacts$`Biomass Boiler` * dh_nox_IF_wood
       df_dh_pm25_impacts$`Biomass CHP` <- df_dh_pm25_impacts$`Biomass CHP` * ph_nox_IF_public
       df_dh_pm25_impacts$`District Heating (Biomass)` <- df_dh_pm25_impacts$`District Heating (Biomass)` * ph_nox_IF_public
       df_dh_pm25_impacts$`District Heating (Biomethane)` <- df_dh_pm25_impacts$`District Heating (Biomethane)` * ph_nox_IF_public
       df_dh_pm25_impacts$`District Heating (Gas)` <- df_dh_pm25_impacts$`District Heating (Gas)` * ph_nox_IF_public
       df_dh_pm25_impacts$`Gas Boiler` <- df_dh_pm25_impacts$`Gas Boiler` * dh_nox_IF_gas
       df_dh_pm25_impacts$`Gas CHP` <- df_dh_pm25_impacts$`Gas CHP` * ph_nox_IF_public
       df_dh_pm25_impacts$`District Heating (Hydrogen)` <- df_dh_pm25_impacts$`District Heating (Hydrogen)` * ph_nox_IF_public
       df_dh_pm25_impacts$`Gas Boiler - H2-NG Blend` <- df_dh_pm25_impacts$`Gas Boiler - H2-NG Blend` * dh_nox_IF_gas
       df_dh_pm25_impacts$`Gas CHP - H2-NG Blend` <- df_dh_pm25_impacts$`Gas CHP - H2-NG Blend` * ph_nox_IF_public
       df_dh_pm25_impacts$`ASHP + Hydrogen Boiler (Hydrogen)` <- df_dh_pm25_impacts$`ASHP + Hydrogen Boiler (Hydrogen)` * dh_nox_IF_gas
       df_dh_pm25_impacts$`Hydrogen Boiler` <- df_dh_pm25_impacts$`Hydrogen Boiler` * dh_nox_IF_gas
       df_dh_pm25_impacts$`Oil Boiler` <- df_dh_pm25_impacts$`Oil Boiler` * dh_nox_IF_oil
       df_dh_pm25_impacts$`Community Heating` <- df_dh_pm25_impacts$`Community Heating` * ph_nox_IF_public
       df_dh_pm25_impacts$`Total Emissions` <- rowSums(df_dh_pm25_impacts[, 2:17], na.rm = TRUE)
       
       
       
       long_df_dh_pm25_impacts <- melt(df_dh_pm25_impacts[, 1:17], id.vars = "Year", variable.name = "Source", value.name = "Impacts", na.rm = TRUE)
       
       ggplot(long_df_dh_pm25_impacts, aes(Year, Impacts, group = Source, col = Source)) +
                geom_line() + 
                labs(y = "PM2.5 PWMC Impacts (ng m-3)")
      
       
       
     })
     
     
     ###################################################################################################################################################
     
     # Public and commercial Heating
     
     # Public and commercial Heating CO2 Emissions
     
     output$ph_co2 <- renderPlot({
       
       req(input_ph_file())
       
       ph_data <- input_ph_file()
       
       colnames = as.character(ph_data[ , 1])
       ph_data = data.frame(t(ph_data[ , -1]))
       colnames(ph_data) = colnames
       ph_data$Sum <- rowSums(ph_data[ , 2:28], na.rm = TRUE)
       ph_data$Year <- format(ph_data$Year, 0)
       
       df_ph_co2_emissions <- ph_data[, 1:17]
       
       df_ph_co2_emissions$`Biofuel Boiler` <- df_ph_co2_emissions$`Biofuel Boiler` * ph_co2_EF_fueloil_boiler
       df_ph_co2_emissions$`ASHP + Biofuel Boiler (Biofuel)` <- df_ph_co2_emissions$`ASHP + Biofuel Boiler (Biofuel)` * ph_co2_EF_fueloil_boiler
       df_ph_co2_emissions$`Biomass Boiler` <- df_ph_co2_emissions$`Biomass Boiler` * ph_co2_EF_biomass_boiler
       df_ph_co2_emissions$`Biomass CHP` <- df_ph_co2_emissions$`Biomass CHP` * ph_co2_EF_biomass_boiler
       df_ph_co2_emissions$`District Heating (Biomass)` <- df_ph_co2_emissions$`District Heating (Biomass)` * ph_co2_EF_biomass_boiler
       df_ph_co2_emissions$`District Heating (Biomethane)` <- df_ph_co2_emissions$`District Heating (Biomethane)` * ph_co2_EF_gas_boiler
       df_ph_co2_emissions$`District Heating (Gas)` <- df_ph_co2_emissions$`District Heating (Gas)` * ph_co2_EF_gas_boiler
       df_ph_co2_emissions$`Gas Boiler` <- df_ph_co2_emissions$`Gas Boiler` * ph_co2_EF_gas_boiler
       df_ph_co2_emissions$`Gas CHP` <- df_ph_co2_emissions$`Gas CHP` * ph_co2_EF_gas_boiler
       df_ph_co2_emissions$`District Heating (Hydrogen)` <- df_ph_co2_emissions$`District Heating (Hydrogen)` * ph_co2_EF_hydrogen_boiler
       df_ph_co2_emissions$`Gas Boiler - H2-NG Blend` <- df_ph_co2_emissions$`Gas Boiler - H2-NG Blend` * ph_co2_EF_hydrogen_natgas_boiler
       df_ph_co2_emissions$`Gas CHP - H2-NG Blend` <- df_ph_co2_emissions$`Gas CHP - H2-NG Blend` * ph_co2_EF_hydrogen_natgas_boiler
       df_ph_co2_emissions$`ASHP + Hydrogen Boiler (Hydrogen)` <- df_ph_co2_emissions$`ASHP + Hydrogen Boiler (Hydrogen)` * ph_co2_EF_hydrogen_boiler
       df_ph_co2_emissions$`Hydrogen Boiler` <- df_ph_co2_emissions$`Hydrogen Boiler` * ph_co2_EF_hydrogen_boiler
       df_ph_co2_emissions$`Oil Boiler` <- df_ph_co2_emissions$`Oil Boiler` * ph_co2_EF_fueloil_boiler
       df_ph_co2_emissions$`Community Heating` <- df_ph_co2_emissions$`Community Heating` * ph_co2_EF_fueloil_boiler
       df_ph_co2_emissions$`Total Emissions` <- rowSums(df_ph_co2_emissions[, 2:17], na.rm = TRUE)
       
       
       long_df_ph_co2_emissions <- melt(df_ph_co2_emissions[, 1:17], id.vars = "Year", variable.name = "Source", value.name = "Emissions", na.rm = TRUE)
       
       ggplot(long_df_ph_co2_emissions, aes(Year, Emissions, group = Source, col = Source)) +
                geom_line() + 
                labs(y = "CO2 Emissions (kt)")
       
       
       
     })
 
     
     ###############################################################################################################     
     
     # Public and commercial Heating NOx Emissions
     
     output$ph_nox <- renderPlot({
       
       req(input_ph_file())
       
       ph_data <- input_ph_file()
       
       colnames = as.character(ph_data[ , 1])
       ph_data = data.frame(t(ph_data[ , -1]))
       colnames(ph_data) = colnames
       ph_data$Sum <- rowSums(ph_data[ , 2:28], na.rm = TRUE)
       ph_data$Year <- format(ph_data$Year, 0)
       
       df_ph_nox_emissions <- ph_data[, 1:17]
       
       df_ph_nox_emissions$`Biofuel Boiler` <- df_ph_nox_emissions$`Biofuel Boiler` * ph_nox_EF_fueloil_boiler
       df_ph_nox_emissions$`ASHP + Biofuel Boiler (Biofuel)` <- df_ph_nox_emissions$`ASHP + Biofuel Boiler (Biofuel)` * ph_nox_EF_fueloil_boiler
       df_ph_nox_emissions$`Biomass Boiler` <- df_ph_nox_emissions$`Biomass Boiler` * ph_nox_EF_biomass_boiler
       df_ph_nox_emissions$`Biomass CHP` <- df_ph_nox_emissions$`Biomass CHP` * ph_nox_EF_biomass_boiler
       df_ph_nox_emissions$`District Heating (Biomass)` <- df_ph_nox_emissions$`District Heating (Biomass)` * ph_nox_EF_biomass_boiler
       df_ph_nox_emissions$`District Heating (Biomethane)` <- df_ph_nox_emissions$`District Heating (Biomethane)` * ph_nox_EF_gas_boiler
       df_ph_nox_emissions$`District Heating (Gas)` <- df_ph_nox_emissions$`District Heating (Gas)` * ph_nox_EF_gas_boiler
       df_ph_nox_emissions$`Gas Boiler` <- df_ph_nox_emissions$`Gas Boiler` * ph_nox_EF_gas_boiler
       df_ph_nox_emissions$`Gas CHP` <- df_ph_nox_emissions$`Gas CHP` * ph_nox_EF_gas_boiler
       df_ph_nox_emissions$`District Heating (Hydrogen)` <- df_ph_nox_emissions$`District Heating (Hydrogen)` * ph_nox_EF_hydrogen_boiler
       df_ph_nox_emissions$`Gas Boiler - H2-NG Blend` <- df_ph_nox_emissions$`Gas Boiler - H2-NG Blend` * ph_nox_EF_hydrogen_natgas_boiler
       df_ph_nox_emissions$`Gas CHP - H2-NG Blend` <- df_ph_nox_emissions$`Gas CHP - H2-NG Blend` * ph_nox_EF_hydrogen_natgas_boiler
       df_ph_nox_emissions$`ASHP + Hydrogen Boiler (Hydrogen)` <- df_ph_nox_emissions$`ASHP + Hydrogen Boiler (Hydrogen)` * ph_nox_EF_hydrogen_boiler
       df_ph_nox_emissions$`Hydrogen Boiler` <- df_ph_nox_emissions$`Hydrogen Boiler` * ph_nox_EF_hydrogen_boiler
       df_ph_nox_emissions$`Oil Boiler` <- df_ph_nox_emissions$`Oil Boiler` * ph_nox_EF_fueloil_boiler
       df_ph_nox_emissions$`Community Heating` <- df_ph_nox_emissions$`Community Heating` * ph_nox_EF_fueloil_boiler
       df_ph_nox_emissions$`Total Emissions` <- rowSums(df_ph_nox_emissions[, 2:17], na.rm = TRUE)
       
       
       # pNOx PWMC Impacts
       
       df_ph_nox_impacts <- df_ph_nox_emissions[, 1:17]
       
       df_ph_nox_impacts$`Biofuel Boiler` <- df_ph_nox_impacts$`Biofuel Boiler` * ph_nox_IF_public
       df_ph_nox_impacts$`ASHP + Biofuel Boiler (Biofuel)` <- df_ph_nox_impacts$`ASHP + Biofuel Boiler (Biofuel)` * ph_nox_IF_public
       df_ph_nox_impacts$`Biomass Boiler` <- df_ph_nox_impacts$`Biomass Boiler` * ph_nox_IF_public
       df_ph_nox_impacts$`Biomass CHP` <- df_ph_nox_impacts$`Biomass CHP` * ph_nox_IF_public
       df_ph_nox_impacts$`District Heating (Biomass)` <- df_ph_nox_impacts$`District Heating (Biomass)` * ph_nox_IF_public
       df_ph_nox_impacts$`District Heating (Biomethane)` <- df_ph_nox_impacts$`District Heating (Biomethane)` * ph_nox_IF_public
       df_ph_nox_impacts$`District Heating (Gas)` <- df_ph_nox_impacts$`District Heating (Gas)` * ph_nox_IF_public
       df_ph_nox_impacts$`Gas Boiler` <- df_ph_nox_impacts$`Gas Boiler` * ph_nox_IF_public
       df_ph_nox_impacts$`Gas CHP` <- df_ph_nox_impacts$`Gas CHP` * ph_nox_IF_public
       df_ph_nox_impacts$`District Heating (Hydrogen)` <- df_ph_nox_impacts$`District Heating (Hydrogen)` * ph_nox_IF_public
       df_ph_nox_impacts$`Gas Boiler - H2-NG Blend` <- df_ph_nox_impacts$`Gas Boiler - H2-NG Blend` * ph_nox_IF_public
       df_ph_nox_impacts$`Gas CHP - H2-NG Blend` <- df_ph_nox_impacts$`Gas CHP - H2-NG Blend` * ph_nox_IF_public
       df_ph_nox_impacts$`ASHP + Hydrogen Boiler (Hydrogen)` <- df_ph_nox_impacts$`ASHP + Hydrogen Boiler (Hydrogen)` * ph_nox_IF_public
       df_ph_nox_impacts$`Hydrogen Boiler` <- df_ph_nox_impacts$`Hydrogen Boiler` * ph_nox_IF_public
       df_ph_nox_impacts$`Oil Boiler` <- df_ph_nox_impacts$`Oil Boiler` * ph_nox_IF_public
       df_ph_nox_impacts$`Community Heating` <- df_ph_nox_impacts$`Community Heating` * ph_nox_IF_public
       df_ph_nox_impacts$`Total Emissions` <- rowSums(df_ph_nox_impacts[, 2:17], na.rm = TRUE)
       
       
       
       long_df_ph_nox_impacts <- melt(df_ph_nox_impacts[, 1:17], id.vars = "Year", variable.name = "Source", value.name = "Impacts", na.rm = TRUE)
       
       ggplot(long_df_ph_nox_impacts, aes(Year, Impacts, group = Source, col = Source)) +
                geom_line() + 
                labs(y = "NOx PWMC Impacts (ng m-3)")
       
       
       
     })
     
    
     
     ###################################################################################################################
     
     # Public and commercial PM2.5 Emissions
     
     output$ph_pm25 <- renderPlot({
       
        req(input_ph_file())
       
       ph_data <- input_ph_file()
       
       colnames = as.character(ph_data[ , 1])
       ph_data = data.frame(t(ph_data[ , -1]))
       colnames(ph_data) = colnames
       ph_data$Sum <- rowSums(ph_data[ , 2:28], na.rm = TRUE)
       ph_data$Year <- format(ph_data$Year, 0)
       
       df_ph_pm25_emissions <- ph_data[, 1:17]
       
       df_ph_pm25_emissions$`Biofuel Boiler` <- df_ph_pm25_emissions$`Biofuel Boiler` * ph_pm25_EF_fueloil_boiler
       df_ph_pm25_emissions$`ASHP + Biofuel Boiler (Biofuel)` <- df_ph_pm25_emissions$`ASHP + Biofuel Boiler (Biofuel)` * ph_pm25_EF_fueloil_boiler
       df_ph_pm25_emissions$`Biomass Boiler` <- df_ph_pm25_emissions$`Biomass Boiler` * ph_pm25_EF_biomass_boiler
       df_ph_pm25_emissions$`Biomass CHP` <- df_ph_pm25_emissions$`Biomass CHP` * ph_pm25_EF_biomass_boiler
       df_ph_pm25_emissions$`District Heating (Biomass)` <- df_ph_pm25_emissions$`District Heating (Biomass)` * ph_pm25_EF_biomass_boiler
       df_ph_pm25_emissions$`District Heating (Biomethane)` <- df_ph_pm25_emissions$`District Heating (Biomethane)` * ph_pm25_EF_gas_boiler
       df_ph_pm25_emissions$`District Heating (Gas)` <- df_ph_pm25_emissions$`District Heating (Gas)` * ph_pm25_EF_gas_boiler
       df_ph_pm25_emissions$`Gas Boiler` <- df_ph_pm25_emissions$`Gas Boiler` * ph_pm25_EF_gas_boiler
       df_ph_pm25_emissions$`Gas CHP` <- df_ph_pm25_emissions$`Gas CHP` * ph_pm25_EF_gas_boiler
       df_ph_pm25_emissions$`District Heating (Hydrogen)` <- df_ph_pm25_emissions$`District Heating (Hydrogen)` * ph_pm25_EF_hydrogen_boiler
       df_ph_pm25_emissions$`Gas Boiler - H2-NG Blend` <- df_ph_pm25_emissions$`Gas Boiler - H2-NG Blend` * ph_pm25_EF_hydrogen_natgas_boiler
       df_ph_pm25_emissions$`Gas CHP - H2-NG Blend` <- df_ph_pm25_emissions$`Gas CHP - H2-NG Blend` * ph_pm25_EF_hydrogen_natgas_boiler
       df_ph_pm25_emissions$`ASHP + Hydrogen Boiler (Hydrogen)` <- df_ph_pm25_emissions$`ASHP + Hydrogen Boiler (Hydrogen)` * ph_pm25_EF_hydrogen_boiler
       df_ph_pm25_emissions$`Hydrogen Boiler` <- df_ph_pm25_emissions$`Hydrogen Boiler` * ph_pm25_EF_hydrogen_boiler
       df_ph_pm25_emissions$`Oil Boiler` <- df_ph_pm25_emissions$`Oil Boiler` * ph_pm25_EF_fueloil_boiler
       df_ph_pm25_emissions$`Community Heating` <- df_ph_pm25_emissions$`Community Heating` * ph_pm25_EF_fueloil_boiler
       df_ph_pm25_emissions$`Total Emissions` <- rowSums(df_ph_pm25_emissions[, 2:17], na.rm = TRUE)
       
       
       # PM2.5 PWMC Impacts
       
       df_ph_pm25_impacts <- df_ph_pm25_emissions[, 1:17]
       
       df_ph_pm25_impacts$`Biofuel Boiler` <- df_ph_pm25_impacts$`Biofuel Boiler` * ph_pm25_IF_public
       df_ph_pm25_impacts$`ASHP + Biofuel Boiler (Biofuel)` <- df_ph_pm25_impacts$`ASHP + Biofuel Boiler (Biofuel)` * ph_pm25_IF_public
       df_ph_pm25_impacts$`Biomass Boiler` <- df_ph_pm25_impacts$`Biomass Boiler` * ph_pm25_IF_public
       df_ph_pm25_impacts$`Biomass CHP` <- df_ph_pm25_impacts$`Biomass CHP` * ph_pm25_IF_public
       df_ph_pm25_impacts$`District Heating (Biomass)` <- df_ph_pm25_impacts$`District Heating (Biomass)` * ph_pm25_IF_public
       df_ph_pm25_impacts$`District Heating (Biomethane)` <- df_ph_pm25_impacts$`District Heating (Biomethane)` * ph_pm25_IF_public
       df_ph_pm25_impacts$`District Heating (Gas)` <- df_ph_pm25_impacts$`District Heating (Gas)` * ph_pm25_IF_public
       df_ph_pm25_impacts$`Gas Boiler` <- df_ph_pm25_impacts$`Gas Boiler` * ph_pm25_IF_public
       df_ph_pm25_impacts$`Gas CHP` <- df_ph_pm25_impacts$`Gas CHP` * ph_pm25_IF_public
       df_ph_pm25_impacts$`District Heating (Hydrogen)` <- df_ph_pm25_impacts$`District Heating (Hydrogen)` * ph_pm25_IF_public
       df_ph_pm25_impacts$`Gas Boiler - H2-NG Blend` <- df_ph_pm25_impacts$`Gas Boiler - H2-NG Blend` * ph_pm25_IF_public
       df_ph_pm25_impacts$`Gas CHP - H2-NG Blend` <- df_ph_pm25_impacts$`Gas CHP - H2-NG Blend` * ph_pm25_IF_public
       df_ph_pm25_impacts$`ASHP + Hydrogen Boiler (Hydrogen)` <- df_ph_pm25_impacts$`ASHP + Hydrogen Boiler (Hydrogen)` * ph_pm25_IF_public
       df_ph_pm25_impacts$`Hydrogen Boiler` <- df_ph_pm25_impacts$`Hydrogen Boiler` * ph_pm25_IF_public
       df_ph_pm25_impacts$`Oil Boiler` <- df_ph_pm25_impacts$`Oil Boiler` * ph_pm25_IF_public
       df_ph_pm25_impacts$`Community Heating` <- df_ph_pm25_impacts$`Community Heating` * ph_pm25_IF_public
       df_ph_pm25_impacts$`Total Emissions` <- rowSums(df_ph_pm25_impacts[, 2:17], na.rm = TRUE)
       
       
       
       long_df_ph_pm25_impacts <- melt(df_ph_pm25_impacts[, 1:17], id.vars = "Year", variable.name = "Source", value.name = "Impacts", na.rm = TRUE)
       
       ggplot(long_df_ph_pm25_impacts, aes(Year, Impacts, group = Source, col = Source)) +
                geom_line() + 
                labs(y = "PM2.5 PWMC Impacts (ng m-3)")
       
       
       
     })
     
     
  
}

shinyApp(ui = ui, server = server)
 
```


